jQuery(function(a){const b={init:function(){a("a.edit_custom").on("click",this.edit_custom_data);a("a.add_custom").on("click",this.display_modal);a(document.body).on("er_backbone_modal_loaded",this.backbone.init).on("er_backbone_modal_response",this.backbone.response);b.init_redraw()},init_redraw:function(){a("a.delete-custom").on("click",this.delete_custom)},edit_custom_data:function(f){f.preventDefault();const d=a(this),c=d.closest(".order_data_column"),g=c.find("div.edit_custom_data"),h=c.find("div.custom_data");h.hide();d.parent().find("a:not(.delete_custom)").toggle();g.show()},display_modal:function(){a(this).ERBackboneModal({template:"er-modal-add-custom"});return false},register:function(){},delete_custom:function(d){const c=window.confirm(easyreservations_admin_meta_boxes.remove_item_notice);if(c){d.preventDefault();a(".custom_data_container").block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});a.ajax({url:easyreservations_admin_meta_boxes.ajax_url,data:{object_id:a("#object_id").val(),object_type:easyreservations_admin_meta_boxes.order?"order":"reservation",receipt_item_ids:a(this).attr("data-receipt_item_id"),action:"easyreservations_remove_custom",security:easyreservations_admin_meta_boxes.receipt_item_nonce},dataType:"json",type:"POST",success:function(e){a(".custom_data_container").closest(".order_data_column").find("a:not(.delete_custom)").toggle();if(e.data.notes_html){a("ul.order_notes").empty();a("ul.order_notes").append(a(e.data.notes_html).find("li"))}a(".custom_data_container").empty();a(".custom_data_container").append(e.data.html);a(".custom_data_container").trigger("er_generated_custom_field").unblock();b.init_redraw()}})}return false},backbone:{init:function(d,c){if("er-modal-add-custom"===c){a(this).on("change",".er-custom-field",function(){const e=a(this).val();if(e){a("#custom_field_value").html(a("#prototype-custom-"+e).clone());a(document.body).trigger("er_generated_custom_field");a("#custom_field_data").show()}else{a("#custom_field_data").hide()}})}},response:function(f,d,c){if("er-modal-add-custom"===d){b.backbone.add_custom(c)}},add_custom:function(c){if(c.custom_field_fee){a("#easyreservations-order-items").block()}a(".custom_data_container").block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});c.action="easyreservations_add_custom";c.security=easyreservations_admin_meta_boxes.custom_nonce;c.object_id=easyreservations_admin_meta_boxes.post_id;c.object_type=easyreservations_admin_meta_boxes.order?"order":"reservation";if(c.custom_field&&c.custom_field!==""){a.ajax({url:easyreservations_admin_meta_boxes.ajax_url,data:c,dataType:"json",type:"POST",success:function(d){a(".custom_data_container").closest(".order_data_column").find("a:not(.delete_custom)").toggle();if(d.data.html){a("#easyreservations-order-items").find(".inside").empty();a("#easyreservations-order-items").find(".inside").append(d.data.html);a("#easyreservations-order-items").trigger("er_receipt_items_reloaded").unblock()}a(".custom_data_container").empty();a(".custom_data_container").append(d.data.custom_html);a(".custom_data_container").trigger("er_generated_custom_field").unblock();b.init_redraw()}})}}}};b.init()});