jQuery(function(b){var a={init:function(){b("a.edit_custom").click(this.edit_custom_data);b("a.add_custom").on("click",this.display_modal);b(document.body).on("er_backbone_modal_loaded",this.backbone.init).on("er_backbone_modal_response",this.backbone.response);a.init_redraw()},init_redraw:function(){b("a.delete-custom").on("click",this.delete_custom)},edit_custom_data:function(f){f.preventDefault();var d=b(this),c=d.closest(".order_data_column"),h=c.find("div.edit_custom_data"),g=c.find("div.custom_data");g.hide();d.parent().find("a:not(.delete_custom)").toggle();h.show()},display_modal:function(){b(this).ERBackboneModal({template:"er-modal-add-custom"});return false},register:function(){},delete_custom:function(d){var c=window.confirm(easyreservations_admin_meta_boxes.remove_item_notice);if(c){d.preventDefault();b(".custom_data_container").block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});var f=b(this).attr("data-receipt_item_id");b.ajax({url:easyreservations_admin_meta_boxes.ajax_url,data:{object_id:b("#object_id").val(),object_type:easyreservations_admin_meta_boxes.order?"order":"reservation",receipt_item_ids:f,action:"easyreservations_remove_custom",security:easyreservations_admin_meta_boxes.receipt_item_nonce},dataType:"json",type:"POST",success:function(e){b(".custom_data_container").closest(".order_data_column").find("a:not(.delete_custom)").toggle();if(e.data.notes_html){b("ul.order_notes").empty();b("ul.order_notes").append(b(e.data.notes_html).find("li"))}b(".custom_data_container").empty();b(".custom_data_container").append(e.data.html);b(".custom_data_container").trigger("er_generated_custom_field").unblock();a.init_redraw()}})}return false},backbone:{init:function(d,c){if("er-modal-add-custom"===c){b(this).on("change",".er-custom-field",function(){var e=b(this).val();if(e){b("#custom_field_value").html(b("#prototype-custom-"+e).clone());b(document.body).trigger("er_generated_custom_field");b("#custom_field_data").show()}else{b("#custom_field_data").hide()}})}},response:function(f,d,c){if("er-modal-add-custom"===d){a.backbone.add_custom(c)}},add_custom:function(c){if(c.custom_field_fee){b("#easyreservations-order-items").block()}b(".custom_data_container").block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});c.action="easyreservations_add_custom";c.security=easyreservations_admin_meta_boxes.custom_nonce;c.object_id=easyreservations_admin_meta_boxes.post_id;c.object_type=easyreservations_admin_meta_boxes.order?"order":"reservation";if(c.custom_field&&c.custom_field!==""){b.ajax({url:easyreservations_admin_meta_boxes.ajax_url,data:c,dataType:"json",type:"POST",success:function(d){b(".custom_data_container").closest(".order_data_column").find("a:not(.delete_custom)").toggle();if(d.data.html){b("#easyreservations-order-items").find(".inside").empty();b("#easyreservations-order-items").find(".inside").append(d.data.html);b("#easyreservations-order-items").trigger("er_receipt_items_reloaded").unblock()}b(".custom_data_container").empty();b(".custom_data_container").append(d.data.custom_html);b(".custom_data_container").trigger("er_generated_custom_field").unblock();a.init_redraw()}})}}}};a.init()});