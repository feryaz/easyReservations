var optTempID=1,ifTempID=1,first=true,added={};function custom_edit(b){if(htmlSettingsCustomLocalizeScript.all_custom_fields&&htmlSettingsCustomLocalizeScript.all_custom_fields[b]){var a=htmlSettingsCustomLocalizeScript.all_custom_fields[b];jQuery("#custom_name").val(a.title);if(a.price){jQuery("#custom_price_field").prop("checked","checked")}custom_type_select(a.type);custom_field_extras(a);custom_field_value(a);jQuery("*[id^=clauses_sortable]").sortable();jQuery("#options_sortable").sortable();jQuery("#mainform").append('<input type="hidden" name="custom_id" id="custom_id" value="'+b+'">')}}function custom_type_select(b){var a={};a.x="--";if(!b){b=jQuery("#custom_field_type").val()}if(!jQuery("#custom_price_field").prop("checked")){a.text="Text field";a.area="Text area"}a.slider="Slider";a.number="Number";a.check="Checkbox";a.select="Select field";a.radio="Radio buttons";jQuery("#custom_field_type").html(generateOptions(a,b))}function custom_field_extras(d){var c="";if(d){c=d.unused}var a='<label class="in-hierarchy" title="Content in emails if custom field wasn\'t chosen." style="margin-bottom:4px;width:104px;display: inline-block;">Unused </label><input type="text" name="custom_field_unused" value="'+c+'">';var b="";if(d&&d.required){b=' checked="checked"'}a+='<p><label class="wrapper"><input type="checkbox" id="custom_field_required" name="custom_field_required"'+b+">Required</label></p>";b="";if(d&&d.admin){b=' checked="checked"'}jQuery("#custom_field_extras").html(a)}function custom_field_value(d){var b=jQuery("#custom_field_type").val();jQuery("#custom_value_tr").remove();if(b!=="x"){var a="",c="";if(b=="text"||b=="area"){if(!d){d=new Array();d.value=""}a='<ul><li class="sortable">Value <input type="text" name="custom_field_value" value="'+d.value+'"></li></ul>'}else{if(b=="select"||b=="radio"||b=="check"){a+='<strong>Options</strong> <a id="add_new_custom" onclick="add_new_option()" style="font-size:14px;" class="dashicons dashicons-plus-alt"></a>'}a+='<ul id="options_sortable">';a+=custom_generate_option(d);a+="</ul>"}jQuery("#custom_type_tr").after('<tr id="custom_value_tr"><td colspan="2">'+a+"</td></tr>");jQuery(document.body).trigger("init_tooltips")}}function custom_generate_option(e){if(!e){var e=new Object();e.type=jQuery("#custom_field_type").val();e.options=new Object();e.options[optTempID]=new Object();e.options[optTempID]["value"]="";if(jQuery("#custom_price_field").prop("checked")){e.options[optTempID]["price"]=100}if(e.type=="check"||e.type=="check"){e.options[optTempID]["checked"]=false}}var c="";for(var b in e.options){var a=e.options[b];c+='<li class="sortable" id="option_'+b+'">';if(e.type=="check"||e.type=="select"||e.type=="radio"){c+='<a style="float:right" onclick="delete_option(this)" class="dashicons dashicons-dismiss"></a>'}c+='<input type="hidden" name="id[]" value="'+b+'">';if(e.type=="slider"){c+='<label class="in-hierarchy">Value</label><input type="number" name="value[]" value="'+a.value+'"><br>';c+='<label class="in-hierarchy">Min</label><input type="number" name="min[]" value="'+a.min+'"><br>';c+='<label class="in-hierarchy">Max</label><input type="number" name="max[]" value="'+a.max+'"><br>';c+='<label class="in-hierarchy">Label</label><input type="text" name="label[]" value="'+a.label+'"><br>';c+='<label class="in-hierarchy">Step</label><input type="number" name="step[]" value="'+a.step+'">'}else{c+='<label class="in-hierarchy">Value</label><input type="text" name="value[]" value="'+a.value+'">'}var d="";if(jQuery("#custom_price_field").is(":checked")&&(e.type=="number"||e.type=="slider")){if(a.mode){d=' checked="checked"'}c+='<br><label class="wrapper" style="margin-left:14px"><input type="checkbox" name="number-price[]" class="er_input_price" '+d+' value="1">Multiply this options price by fields value </label>'}else{if(e.type=="check"||e.type=="select"||e.type=="radio"){if(a.checked){d=' checked="checked"'}c+='<br><label class="in-hierarchy">Checked</label><label class="wrapper"><input type="checkbox" name="checked[]"'+d+' onchange="check_checkboxes(this)" value="1"></label>'}else{c+='<input type="hidden" name="checked[]" value="0">'}}if(jQuery("#custom_price_field").is(":checked")){c+='<br><label class="in-hierarchy">Price</label><span class="input-wrapper"><input type="text" name="price[]" class="er_input_price" value="'+a.price+'" style="width:50px;text-align:right"><span class="input-box">'+htmlSettingsCustomLocalizeScript.currency+"</span></span>";c+='<br><strong>Conditions</strong> <a id="add_if_clause" onclick="add_if_clause(\''+b+'\');" style="font-size: 14px;" class="dashicons dashicons-plus-alt"></a><ul id="clauses_sortable'+b+'">';if(a.clauses){for(var f in a.clauses){c+=add_if_clause(b,a.clauses[f])}}c+="</ul>"}c+="</li>"}return c}function add_if_clause(h,d){if(d){var g=d}else{var g={price:"",cond:1,operator:"equal",type:"units",mult:"x"}}var e='<li class="sortable clause" id="if_clause_'+h+"_"+ifTempID+'">';e+='<a style="float:right" onclick="delete_option(this)" class="dashicons dashicons-dismiss"></a>';e+='If <span class="select"><select name="if_cond_type[]" onchange="change_operator(this);">';var f={units:"Billing units",resource:"Resource",adult:"Adults",child:"Children",arrival:"Arrival",departure:"Departure",time:"Current date",arrival_every:"Arrival w/o year",departure_every:"Departure w/o year",time_every:"Current date w/o year",field:"Custom price field"};var b=jQuery("#custom_field_type").val();if(b=="slider"||b=="number"){f.value="This field's value"}e+=generateOptions(f,g.type);e+="</select></span>";var a=g.price;e+=generate_if_clause_condition(g);if(!isNaN(parseFloat(g.price))&&isFinite(g.price)){a="price"}e+='<span class="select"><select name="if_cond_happens[]" onchange="clause_happens_select(jQuery(this).val(),\''+h+"', "+ifTempID+', true)">'+generateOptions({x:"--",and:"AND",or:"OR",price:"THEN"},a)+"</select></span>";e+=clause_happens_select(g.price,h,ifTempID,false,g.mult);e+='<input type="hidden" name="if_option[]" value="'+h+'"></li>';ifTempID++;if(!d){jQuery("#clauses_sortable"+h).append(e).sortable()}else{return e}}function generate_if_clause_condition(b){var c="";if(b.type=="field"){var a=generate_customs_select(b.operator);if(!a){c+='<b name="if_cond[]">Add price fields first</b>'}else{c+=' <span class="select delete"><select name="if_cond_operator[]" onchange="change_condition_options(this)" class="tips" data-tip="Other price field that has to be selected">'+a[0]+'</select></span><span class="delete"> and option </span>';c+=' <span class="select delete"><select name="if_cond[]" class="tips" data-tip="Price fields option that has to be selected">'+generate_customs_options_select(a[1],b.cond)+'</select></span><span class="delete"> are selected </span>'}}else{if(b.type=="resource"){c+='<span class="select delete"><select name="if_cond_operator[]">'+generateOptions({equal:"=",notequal:"!="},b.operator)+"</select></span> ";c+='<span class="select delete"><select name="if_cond[]" class="tips" data-tip="Resource that has to be selected">'+generateOptions(htmlSettingsCustomLocalizeScript.resources,b.cond)+"</select></span>"}else{c+='<span class="select delete"><select name="if_cond_operator[]">'+generateOptions({equal:"=",notequal:"!=",greater:">",greaterequal:">=",smaller:"<",smallerequal:"<="},b.operator)+"</select></span> ";if(b.type=="arrival"||b.type=="departure"||b.time=="time"){c+='<input type="text" name="if_cond[]" onclick="generate_datepicker(this);" class="er-datepicker" value="'+b.cond+'" style="width:100px;text-align:center"> '}else{if(b.type=="arrival_every"||b.type=="departure_every"||b.type=="time_every"){c+='<input type="text" name="if_cond[]" onclick="generate_datepicker(this);" data-format="mm.dd" class="er-datepicker" value="'+b.cond+'" style="width:100px;text-align:center"> '}else{c+='<input type="text" name="if_cond[]" class="tips" data-tip="Number that has to be matched" value="'+b.cond+'" style="width:50px;text-align:center"> '}}}}return c}function generate_customs_select(c){var a={};for(var b in htmlSettingsCustomLocalizeScript.all_custom_fields){if(htmlSettingsCustomLocalizeScript.all_custom_fields[b]["price"]){if(!c||(isNaN(parseFloat(c))&&!isFinite(c))){c=b}a[b]=htmlSettingsCustomLocalizeScript.all_custom_fields[b]["title"]}}if(a=={}){return false}else{return[generateOptions(a,c),c]}}function generate_customs_options_select(d,c){var a={};a.any="Any";if(htmlSettingsCustomLocalizeScript.all_custom_fields[d]){for(var b in htmlSettingsCustomLocalizeScript.all_custom_fields[d]["options"]){a[b]=htmlSettingsCustomLocalizeScript.all_custom_fields[d]["options"][b]["value"]}}return generateOptions(a,c)}function clause_happens_select(d,f,b,a,e){jQuery("#if_clause_amount_"+f+"_"+b+",#if_clause_mult_"+f+"_"+b+",#delete_"+f+"_"+b).remove();var c="";if(d=="price"||jQuery.isNumeric(d)){if(d=="price"){d=0}c+='<span class="delete" id="delete_'+f+"_"+b+'">';c+='<span class="input-wrapper delete"><input type="text" name="if_cond_amount[]" id="if_clause_amount_'+f+"_"+b+'" class="er_input_price" value="'+d+'" style="width:55px;text-align:right"><span class="input-box">'+htmlSettingsCustomLocalizeScript.currency+"</span></span> per ";c+='<span class="select delete"><select name="if_cond_mult[]" id="if_clause_mult_'+f+"_"+b+'">'+generateOptions({x:"--",price_pers:"Person",price_adul:"Adult",price_child:"Children",price_halfhour:"Half-hour",price_hour:"Hour",price_realday:"Day",price_night:"Night",price_week:"Week",price_month:"Month",price_day:"Billing unit",price_both:"Unit and person",price_day_adult:"Unit and adult",price_day_child:"Unit and children"},e)+"</select></span></span>"}else{if(d!==""&&d!=="x"){c='<input type="hidden" name="if_cond_amount[]" id="if_clause_amount_'+f+"_"+b+'" class="er_input_price" value="0">';c+='<input type="hidden" name="if_cond_mult[]" id="if_clause_mult_'+f+"_"+b+'" value="x">';if(a){if(!added[f+b]){add_if_clause(f,false)}added[f+b]=1}}}if(a){jQuery("#if_clause_"+f+"_"+b).append(c)}else{return c}}function add_new_option(){optTempID++;var a=custom_generate_option(false);jQuery("#options_sortable").append(a).sortable()}function delete_option(a){jQuery(a).parent().remove()}custom_type_select(false);custom_field_extras();function generate_datepicker(a){jQuery(document).trigger("er-init-datepicker");jQuery(a).datepicker("show")}function change_operator(b){b=jQuery(b).parent().parent();var a=generate_if_clause_condition({price:"",cond:"",operator:"equal",type:b.find('*[name="if_cond_type[]"]').val()});b.find('*[name="if_cond[]"], span.delete').remove();b.find('*[name="if_cond_happens[]"]').prop("selectedIndex",0);b.find('*[name="if_cond_type[]"]').parent().after(a);jQuery(document.body).trigger("init_tooltips")}function change_condition_options(a){a=jQuery(a).parent();a.find('*[name="if_cond[]"]').html(generate_customs_options_select(a.find('*[name="if_cond_operator[]"]').val()))}function check_checkboxes(a){jQuery('input[type=checkbox][name="checked[]"]:checked').each(function(b){if(a!==this){jQuery(this).prop("checked",false)}})}jQuery("#custom_field_type").on("change",function(){custom_field_value(false)});jQuery("#custom_price_field").on("click",function(){custom_type_select(false);custom_field_extras(false);custom_generate_option(false);custom_field_value(false)});jQuery("#custom_cancel").on("click",function(){jQuery("#custom_id").remove()});jQuery("#mainform").on("submit",function(){jQuery('input[type=checkbox][name="checked[]"]:not(:checked)').prop("value","0").prop("type","hidden")});