(function(E,M){var F=E(".er-timeline-tooltip"),j=E(".er-timeline"),B=E("#timeline-datepicker"),o=j.find("div.sidebar"),g=j.find("div.timeline"),d=j.find("div.header"),G=j.find("div.resources table tbody"),x=d.find(".date"),s=g.find("table"),k=s.find("thead.main tr"),y=s.find("thead:not(.main)"),I=s.find("tbody"),c=[],z=false,l=new Date(),v=new Date(),p=false,H=false,K=false,C=false,h=false,r=false,e=0,b=0,D=true,f=false,A=false,w=false,n={height:32,width:96},q=0,L=0,J=0,u=M.first_hour,i=M.last_hour,a=M.default_interval;d.on("click",".expand-sidebar",function(){o.addClass("expanded").show();E(this).removeClass("expand-sidebar").addClass("contract-sidebar")}).on("click",".contract-sidebar",function(){o.removeClass("expanded").hide(300,"linear");E(this).removeClass("contract-sidebar").addClass("expand-sidebar")}).on("click",".hourly",function(){if(!E(this).hasClass("active")){d.find(".daily").removeClass("active");E(this).addClass("active");v=new Date(z.getTime());a="3600";t.init()}}).on("click",".daily",function(){if(!E(this).hasClass("active")){d.find(".hourly").removeClass("active");E(this).addClass("active");v=new Date(z.getTime());a="86400";t.init()}}).on("click",".pending",function(){m.toggle_pending()}).on("click",".date",function(){m.toggle_calendar()}).on("click",".today",function(){t.jump_to_date(l)});B.bind("change",function(N){t.jump_to_date(E(this).datepicker("getDate"))});k.on("mousedown","th",function(N){f=g.scrollLeft()+N.pageX});E(window).mouseup(function(){k.css("cursor","grab");clearInterval(A);A=false;f=false;t.clear_scroll_add_interval()});j.mousemove(function(N){e=N.pageX;b=N.pageY;if(f&&N.which===1){g.scrollLeft(f-N.pageX<1?1:f-N.pageX);t.set_current_date();if(w===false){k.css("cursor","grabbing");t.start_scroll_add_interval()}}if(q!==N.target){q=N.target;if(q.getAttribute("data-date")){t.highlight_current(new Date(parseInt(N.target.getAttribute("data-date"),10)))}if(q.getAttribute("data-space")){C=E(q).offset().top}else{if(q.getAttribute("data-id")){C=E(q).parent().offset().top}}}}).mouseleave(function(){k.css("cursor","grab");clearInterval(A);A=false;f=false;t.clear_scroll_add_interval()}).on("mousedown",".next",function(){if(A===false){t.add_new_column();t.set_current_date();A=setInterval(function(){t.add_new_column();t.set_current_date()},100)}}).on("mousedown",".prev",function(){if(A===false){t.add_new_column(true);t.set_current_date();A=setInterval(function(){t.add_new_column(true);t.set_current_date()},100)}}).on("click",".resource-handler",function(){var O=E(this).parent().parent().parent().next(),N=O.index()/2-1;if(E(this).hasClass("retracted")){E(this).removeClass("retracted");E(I[N]).show();O.show()}else{E(this).addClass("retracted");E(I[N]).hide();O.hide()}}).on("click",".reservation",function(){var N=parseInt(E(this).attr("data-id"),10);g.find(".reservation.selected").removeClass("selected");E(this).addClass("selected");m.display_reservation(c[N])}).on("keydown",".reservation .title",function(N){if(N.keyCode===13){var O=E(this).parents(".reservation").attr("data-id");c[O].title=E(this).html();E(this).blur();m.display_reservation(c[O]);return false}});o.on("click",".allow-edit",function(){var N=parseInt(E(this).attr("data-reservation-id"),10);if(h){t.update_reservation(N);m.stop_edit(h.id)}h=JSON.parse(JSON.stringify(c[N]));o.find("> .reservation-details .edit-actions").show();t.reservation_allow_edit(g.find('.reservation[data-id="'+N+'"]'));E(this).html(M.i18n_stop_edit).addClass("stop-edit").removeClass("allow-edit")}).on("click",".stop-edit",function(){var N=parseInt(E(this).attr("data-reservation-id"),10);t.update_reservation(N);m.stop_edit(N)}).on("click",".status",function(){if(!E(this).hasClass("reservation-status")){var O=parseInt(E(this).parent().parent().attr("data-reservation-id"),10),N=E(this).attr("data-status");c[O].status=N;g.find('.reservation[data-id="'+O+'"]').removeClass("approved checked completed").addClass(N);m.display_reservation(c[O]);t.update_reservation(O)}}).on("click",".snapping",function(){if(E(this).hasClass("enabled")){D=false;E(this).removeClass("enabled")}else{D=true;E(this).addClass("enabled")}}).on("click",".revert",function(){var N=parseInt(E(this).attr("data-reservation-id"),10);t.recursively_remove_reservation(c[N]);g.find('.reservation[data-id="'+N+'"]').remove();h.changed=true;t.add_reservation(h);t.draw_reservations();m.stop_edit(N)});var m={init:function(){if(M.pending&&M.pending.length>0){d.find(".pending").html("<span>"+M.pending.length+"</span>");var N=o.find("> .pending").find(".reservations");N.html("");E.each(M.pending,function(O,Q){var P=E('<div class="pending-reservation">'),S=parseInt(Q.resource,10),R=false;Q.arrival=new Date(Q.arrival);Q.departure=new Date(Q.departure);if(!Q.title){Q.title="No title"}P.html("<span>#"+Q.id+" "+Q.title+"</span>");P.bind("click",function(){t.jump_to_date(Q.arrival);if(S>0){j.find('.resource-handler:not([data-resource="'+Q.resource+'"],.retracted)').click()}E.each(M.resources,function(T,V){if(!R&&(S===0||S===V.ID)){if(V.availability_by==="unit"){Q.resource=V.ID;Q.space=1;R=true;return false}else{Q.resource=V.ID;for(var U=1;U<=V.quantity;U++){Q.space=1;if(t.check_availability(Q)){R=true;break}}}}});if(R){Q.status="approved";t.add_reservation(Q);t.draw_reservations();M.pending.splice(O);E(this).remove();m.init()}});N.append(P)})}else{d.find(".pending").html("");o.find("> .pending").find(".reservations").html(M.i18n_no_pending)}m.display_calendar()},is_open:function(){return o.hasClass("expanded")},open:function(){if(!m.is_open()){d.find(".expand-sidebar").click()}},close:function(){if(m.is_open()){d.find(".contract-sidebar").click()}},toggle:function(){if(m.is_open()){d.find(".contract-sidebar").click();return false}else{d.find(".expand-sidebar").click();return true}},toggle_calendar:function(){if(!o.find("> .calendar").hasClass("visible")){m.display_calendar();m.open()}else{m.toggle()}},toggle_pending:function(){if(!o.find("> .pending").hasClass("visible")){m.display_pending();m.open()}else{m.toggle()}},clear:function(){o.find("> .visible").hide().removeClass("visible")},display_calendar:function(){var N=o.find("> .calendar");m.clear();N.show().addClass("visible")},display_pending:function(){var N=o.find("> .pending");m.clear();N.show().addClass("visible")},stop_edit:function(N){o.find("> .reservation-details .edit-actions").hide();o.find("> .reservation-details .stop-edit").html(M.i18n_allow_edit).removeClass("stop-edit").addClass("allow-edit");if(h){t.reservation_stop_edit(E('.reservation[data-id="'+N+'"]'));h=false}},display_reservation:function(P){var O=o.find("> .reservation-details"),N=O.find(".reservation-header"),Q=M.resources[P.resource];N.find(".title").html(P.title);N.find(".reservation-status").attr("class","reservation-status status-"+P.status);O.attr("data-reservation-id",P.id);O.find(".reservation-preview").attr("data-reservation-id",P.id).data("reservation-data",false);O.find(".snapping").removeClass("enabled");O.find(".revert").attr("data-reservation-id",P.id);O.find(".input-box.reservation-status").removeClass("reservation-status");O.find(".input-box.status-"+P.status).addClass("reservation-status");O.find(".reservation-arrival").html(easyFormatDate(P.arrival,"full"));O.find(".reservation-departure").html(easyFormatDate(P.departure,"full"));O.find(".reservation-resource").html(Q.post_title);O.find(".reservation-adults").html(P.adults);O.find(".reservation-children").html(P.children);if(h&&h.id===P.id){O.find(".edit-actions").show();O.find(".allow-edit").html(M.i18n_stop_edit).removeClass("allow-edit").addClass("stop-edit");O.find(".stop-edit").attr("data-reservation-id",P.id)}else{O.find(".stop-edit").html(M.i18n_allow_edit).removeClass("stop-edit").addClass("allow-edit");O.find(".allow-edit").attr("data-reservation-id",P.id);O.find(".edit-actions").hide()}if(Q.availability_by!=="unit"){O.find(".reservation-space").hide()}else{O.find(".reservation-space").show().html(typeof Q.spaces[P.space]==="undefined"?P.space:Q.spaces[P.space])}if(P.order_id==="0"){O.find(".reservation-order").html(M.i18n_no_order)}else{O.find(".reservation-order").html(M.i18n_order.replace("%s",'<a href="'+M.order_url.replace("%s",P.order_id)+'" target="_blank">#'+P.order_id+"</a>"))}if(D){O.find(".snapping").addClass("enabled")}m.clear();O.show().addClass("visible");m.open()}};var t={init:function(){l=new Date();c=[];z=false;if(a==="86400"){l.setHours(0,0,0,0);v.setHours(0,0,0,0)}else{l.setHours(l.getHours(),0,0,0);if(l.getDate()===v.getDate()&&l.getMonth()===v.getMonth()&&l.getFullYear()===v.getFullYear()){v.setHours(l.getHours(),0,0,0)}else{v.setHours(0,0,0,0)}}s.find("td,th").remove();v=t.manipulate_date_without_offset(v,(15*a*1000)*-1);p=new Date(v.getTime());J=new Date(v.getTime());L=new Date(v.getTime());for(var N=0;N<50;N++){p=t.manipulate_date_without_offset(p,a*1000);t.generate_column(p,false)}t.load_remaining();g.scrollLeft(k.find("th:nth-child(15)").offset().left-g.offset().left+g.scrollLeft()+1);t.set_current_date();t.sync_cell_heights()},manipulate_date_without_offset:function(O,P){var R=new Date(O.getTime()+P);if(a==="3600"){if(R.getHours()<u){if(P>=0){R=new Date(R.getTime()+(u*3600000-(R.getHours()*3600000+R.getMinutes()*60000)))}else{R=new Date(R.getTime()-86400000+(R.getHours()*3600000+R.getMinutes()*60000)-86400000+i*3600000)}}else{if(R.getHours()>i){if(P>=0){R=new Date(R.getTime()+86400000-(R.getHours()*3600000+R.getMinutes()*60000)+u*3600000)}else{R.setHours(i,0,0,0)}}}var Q=R.getTime()-O.getTime();if(Q>86400000){var N=Math.floor(Q/86400000);R=new Date(R.getTime()-(N*(u*3600000)+N*(86400000-i*3600000)))}}return new Date(R.getTime()+R.getTimezoneOffset()*1000*60-O.getTimezoneOffset()*1000*60)},highlight_current:function(N){s.find("td.hover, th.hover").removeClass("hover");s.find('td[data-date="'+N.getTime()+'"], th[data-date="'+N.getTime()+'"]').addClass("hover")},set_current_date:function(){var N=t.manipulate_date_without_offset(v,((Math.round(g.scrollLeft()/n.width)+1)*a*1000));if(a==="3600"){N.setHours(N.getHours(),0,0,0)}else{N.setHours(0,0,0,0)}if(!z||N.getDate()!==z.getDate()||N.getMonth()!==z.getMonth()||N.getFullYear()!==z.getFullYear()){z=N;if(a==="3600"){x.html(z.getDate()+" "+er_date_picker_params.month_names[z.getMonth()]+" "+z.getFullYear())}else{x.html(er_date_picker_params.month_names[z.getMonth()]+" "+z.getFullYear())}k.find("th.current").removeClass("current");k.find('th[data-date="'+z.getTime()+'"]').addClass("current");B.datepicker("setDate",z)}else{if(a==="3600"&&N.getHours()!==z.getHours()){z=N;k.find("th.current").removeClass("current");k.find('th[data-date="'+z.getTime()+'"]').addClass("current")}}},start_scroll_add_interval:function(){if(w===false&&(g.scrollLeft()<2||g[0].scrollWidth-(g.width()+g.scrollLeft())<2)){w=setInterval(function(){if(w!==false&&(g.scrollLeft()<2||g[0].scrollWidth-(g.width()+g.scrollLeft())<2)){t.add_new_column(g.scrollLeft()<2);t.set_current_date()}},38)}},clear_scroll_add_interval:function(){if(w!==false){clearInterval(w);w=false;t.load_remaining()}},jump_to_date:function(N){if(N<v||N>p){v=N;t.init()}else{var P=(z.getTime()-N.getTime()+N.getTimezoneOffset()*1000*60-z.getTimezoneOffset()*1000*60)/(a*1000);for(var O=1;O<=Math.abs(P);O++){t.add_new_column(P>0)}t.set_current_date()}},add_new_column:function(N){if(N){v=t.manipulate_date_without_offset(v,a*1000*-1);t.generate_column(v,true);s.find("th:last-child,td:last-child").remove();J=t.manipulate_date_without_offset(J,a*1000*-1);p=t.manipulate_date_without_offset(p,a*1000*-1)}else{p=t.manipulate_date_without_offset(p,a*1000);t.generate_column(p,false);s.find("th:first-child").remove();s.find("td:first-child").each(function(){var O=E(this).data("reservations");if(O&&O.length>0){E.each(O,function(P,Q){if(c[Q]&&typeof c[Q]!=="undefined"){c[Q].changed=true}})}}).remove();L=t.manipulate_date_without_offset(L,a*1000);v=t.manipulate_date_without_offset(v,a*1000)}t.sync_cell_heights()},load_remaining:function(){if(L===0||L>v){t.load_data(v,L);L=new Date(v.getTime())}else{if(J<p){var N=t.manipulate_date_without_offset(p,a*1000);t.load_data(J,N);J=N}else{}}},load_data:function(O,N){E.ajax({url:M.ajax_url,data:{action:"easyreservations_timeline_data",security:M.nonce,start:O.getDate()+"."+(O.getMonth()+1)+"."+O.getFullYear(),start_hour:O.getHours(),end:N.getDate()+"."+(N.getMonth()+1)+"."+N.getFullYear(),end_hour:N.getHours(),interval:a},type:"POST",success:function(P){if(P.data){E.each(P.data,function(S,R){var Q=M.resources[S].quantity;E.each(R,function(X,T){var V=new Date(parseInt(X,10)*1000),U="",W;if(T<0){U="unavailable";W=0}else{W=Q-T}I.find('td[data-date="'+(V.getTime()+(V.getTimezoneOffset()*1000*60))+'"][data-resource="'+S+'"]').removeClass("loading").addClass(U);y.find('th[data-date="'+(V.getTime()+(V.getTimezoneOffset()*1000*60))+'"][data-resource="'+S+'"]').html("<div><span>"+W+"</span></div>").addClass(parseInt(T,10)===Q?"unavailable":"")})})}if(P.reservations){E.each(P.reservations,function(Q,R){t.add_reservation(R)});t.draw_reservations()}}})},update_reservation:function(O){var N=c[O];E.ajax({url:M.ajax_url,data:{action:"easyreservations_timeline_update_reservation",security:M.nonce,id:O,arrival:easyFormatDate(N.arrival,"full"),departure:easyFormatDate(N.departure,"full"),status:N.status,resource:N.resource,space:N.space,title:N.title},type:"POST",success:function(P){if(P.data){}if(P.reservation){t.add_reservation(P.reservation);t.draw_reservations()}}})},draw_reservations:function(){var N=[],O=true;E.each(c,function(P,Q){if(Q&&Q.changed&&Q.status!=="pending"){N.push(Q.id)}});N.sort(function(Q,P){return c[Q].arrival<c[P].arrival?-1:1});E.each(N,function(P,Q){if(Q){if(!t.draw_reservation(c[Q])){t.draw_reservations();O=false;return false}}});if(O&&N.length>0){t.sync_cell_heights()}},recursively_remove_reservation:function(Q){var R=parseInt(Q.id,10),P=new Date(Q.arrival.getTime()),O=new Date(Q.departure.getTime());if(a==="86400"){P.setHours(0,0,0);O.setHours(0,0,0)}else{P.setHours(P.getHours(),0,0);O.setHours(O.getHours(),0,0)}while(P<=O){var N=E('td[data-date="'+(P.getTime())+'"][data-resource="'+Q.resource+'"][data-space="'+Q.space+'"]');if(N.length>0){t.recursively_remove_reservations(N,Q.depths,R)}P=t.manipulate_date_without_offset(P,a*1000)}},recursively_remove_reservations:function(O,S,T){var N=O.data("reservations"),R=[],P=false,Q=0;if(N&&N.length>0){E.each(N,function(U,V){if(V){if(V===T||c[V].depths>=S){if(P===false){P=c[V].depths}P=Math.min(P,c[V].depths);r=true;c[V].changed=true}else{R.push(V);Q=Math.max(Q,c[V].depths)}}})}O.data("reservations",R);if(P!==false){t.recursively_remove_reservations(O.next(),P,T)}},reservation_stop_edit:function(N){N.draggable("destroy").resizable("destroy");N.find(".title").attr("contenteditable","false")},reservation_allow_edit:function(N){N.draggable({snap:D?false:".reservation",snapTolerance:3,scroll:false,helper:"clone",appendTo:".timeline",stack:".reservation",scope:"reservations",cancel:".title",revert:function(O,P){if(O){return O}E(this).data("uiDraggable").originalPosition={top:H.top-1,left:H.left};return !O},start:function(O,P){H=P.originalPosition;K=P.offset},drag:function(R,S){var U=parseInt(S.helper.attr("data-id"),10),O=c[U],T=a/n.width*(S.position.left-H.left),P=e-g.offset().left;if(D){var Q=Math.round((S.position.left-H.left)/n.width);T=Q*a;S.position.left=H.left+(Q*n.width)}F.html(easyFormatTime(t.manipulate_date_without_offset(O.arrival,T*1000))+" - "+easyFormatTime(t.manipulate_date_without_offset(O.departure,T*1000))).css({top:b,left:Math.min(e-130,g.width()),display:"block"});if(C!==false){S.position.top=C-K.top+H.top}if((P>0&&P<15)||g.width()-P<15){if(A===false){A=setInterval(function(){if(A!==false){var V=e-g.offset().left;if(w===false&&((V>0&&V<15)||g.width()-V<15)){t.add_new_column(V<15);H.left=H.left+(V<15?n.width:n.width*-1)}g.scrollLeft(Math.max(1,g.scrollLeft()+(V<15?n.width*-1:n.width)))}},130)}}else{if(A!==false){clearInterval(A);A=false;t.load_remaining()}}},stop:function(){F.css("display","none");if(A!==false){clearInterval(A);A=false;t.load_remaining()}}}).resizable({handles:"e, w",grid:D?[96,26]:false,maxWidth:n.width*50,scroll:0,minHeight:0,minWidth:4,start:function(O,P){P.originalElement.attr("style","left: "+P.originalElement.css("left")+";top: "+P.originalElement.css("top")+" !important;width: "+P.originalElement.css("width"))},resize:function(R,T){var U=parseInt(T.element.attr("data-id"),10),P=c[U],O=a/n.width*(T.position.left-T.originalPosition.left),S=a/n.width*(T.size.width+2),Q;if(T.position.left-T.originalPosition.left!==0){Q=easyFormatTime(t.manipulate_date_without_offset(P.arrival,O*1000))}else{if(T.size.width-T.originalSize.width!==0){Q=easyFormatTime(t.manipulate_date_without_offset(P.arrival,S*1000))}else{Q=easyFormatTime(t.manipulate_date_without_offset(P.arrival,O*1000));Q+=" - ";Q+=easyFormatTime(t.manipulate_date_without_offset(P.arrival,S*1000))}}F.html(Q).css({top:b,left:Math.min(e-130,g.width()),display:"block"})},stop:function(Q,S){var T=parseInt(S.element.attr("data-id"),10),O=a/n.width*(S.position.left-S.originalPosition.left),R=a/n.width*(S.size.width+2),P={id:T,arrival:t.manipulate_date_without_offset(c[T].arrival,O*1000),departure:t.manipulate_date_without_offset(c[T].arrival,(O*1000)+(R*1000)),resource:c[T].resource,space:c[T].space};if(M.resources[c[T].resource].availability_by!=="unit"||t.check_availability(P)){t.recursively_remove_reservation(c[T]);c[T].arrival=P.arrival;c[T].departure=P.departure;c[T].changed=true;t.draw_reservations()}else{S.helper.animate({width:S.originalSize.width,left:S.originalPosition.left},500,function(){})}F.css("display","none")}});N.find(".title").attr("contenteditable","true")},draw_reservation:function(P){var N=parseInt(P.id,10),Q=new Date(P.arrival.getTime()),S=new Date(P.departure.getTime()),T=E('<div class="reservation">'),O=t.manipulate_date_without_offset(P.arrival,P.departure.getTime()-P.arrival.getTime()).getTime()-t.manipulate_date_without_offset(P.arrival,0).getTime(),V=(((O/1000)/a)*n.width)-2,Y=false,Z=[],W=0;r=false;if(a==="86400"){Q.setHours(0,0,0);S.setHours(0,0,0)}else{Q.setHours(Q.getHours(),0,0);S.setHours(S.getHours(),0,0)}while(Q<=S){var X=E('td[data-date="'+(Q.getTime())+'"][data-resource="'+P.resource+'"][data-space="'+P.space+'"]');if(X&&X.length>0){var U=X.data("reservations");if(U.length>0){E.each(U,function(aa,ab){if(ab&&ab!==N){if(c[ab].arrival>P.arrival&&c[ab].arrival<P.departure&&c[ab].departure>P.arrival){t.recursively_remove_reservations(X,W,ab)}else{if(c[ab].departure<=P.arrival||c[ab].arrival>=P.departure){}else{Z[c[ab].depths]=1}}}})}if(Y===false){T.css("left",(((t.manipulate_date_without_offset(P.arrival,0)-Q.getTime())/1000/a*n.width)-1)+"px");Y=X}if(E.inArray(N,U)<0){U.push(N);X.data("reservations",U)}}Q=t.manipulate_date_without_offset(Q,a*1000)}if(Y===false){c[N].changed=false;return true}else{if(r){return false}else{T.html('<span class="wrapper"><span class="sticky"><span class="id">'+N+'</span><div class="title">'+P.title+"</div></span></span>").css("min-width",V+"px").css("max-width",V+"px").css("top","0px").css("position","absolute").addClass(P.status).attr("data-tip",P.id).attr("data-id",P.id);var R=E('.reservation[data-id="'+N+'"]').remove();if(R.length>0){T.addClass("fade-in-fast")}if(h&&h.id===N){m.display_reservation(P);t.reservation_allow_edit(T);g.find(".reservation.selected").removeClass("selected");T.addClass("selected")}Y.append(T);while(Z[W]===1){W++}if(W>0){if(Y.height()<n.height+(n.height-3)*W){Y.height(n.height+(n.height-3)*W)}T.css("top",(n.height-3)*W+"px")}P.depths=W;P.changed=false;console.log("did draw "+N+"at depths "+W);c[N]=P}}return Y},add_reservation:function(N){var O=parseInt(N.id,10);N.id=O;N.arrival=new Date(N.arrival);N.departure=new Date(N.departure);N.resource=parseInt(N.resource,10);N.space=parseInt(N.space,10);if(typeof c[O]==="undefined"){N.changed=true}else{N.changed=c[O].changed;N.depths=c[O].depths}c[O]=N},check_availability:function(N){var P=parseInt(N.id,10),O=true;E.each(c,function(Q,R){if(R&&R.resource===N.resource&&R.space===N.space&&R.id!==P&&(N.arrival<R.departure&&N.departure>R.arrival)){O=false;return false}});return O},sync_cell_heights:function(){var N,O;G.each(function(P,Q){N=E(Q).index()/2-1;E(Q).children().each(function(R,S){O=E(S).index();E(S).height(E(I[N]).children().eq(E(S).index()).height())})})},generate_column:function(R,V){var P,Z="",N=0,S=0,W=R.getDay()===0?6:R.getDay()-1;if(a==="86400"){P=E('<th><div class="date"><span>'+easyFormatDate(R,"d")+"</span><div>"+er_date_picker_params.day_names_min[W]+"</div></div></th>");if(R.getDate()===1){P.append(E('<div class="first-of-month"></div>'))}}else{var aa=er_both_params.time_format.charAt(er_both_params.time_format.length-1),X=easyAddZero(R.getMinutes());if(aa==="a"){X=R.getHours()>=12?"pm":"am"}else{if(aa==="a"){X=R.getHours()>=12?"PM":"AM"}}P=E('<th><div class="date"><span>'+easyFormatDate(R,"H")+"</span><div>"+X+"</div></div></th>");if(R.getHours()===0){P.append(E('<div class="first-of-month"></div>'))}}if(R.getDate()===l.getDate()&&R.getMonth()===l.getMonth()&&R.getFullYear()===l.getFullYear()&&(a==="86400"||R.getHours()===l.getHours())){var Y=E('<div class="today"></div>'),O=E('<div class="overlay"></div>'),U=new Date(),Q;if(a==="86400"){Q=n.width/86400*(U.getHours()*3600+U.getMinutes()*60)-1}else{Q=n.width/3600*(U.getMinutes()*60)-1}Y.css("left",Q);O.css("left",Q).css("width",Q).css("margin-left",-Q);P.append(Y).append(O);Z+=" today"}else{if(R<l){Z+=" past"}}if(a==="86400"&&(R.getDay()===0||R.getDay()===6)){Z+=" weekend"}P.addClass(Z).attr("data-date",R.getTime());Z+=" loading";if(V){k.prepend(P)}else{k.append(P)}E.each(M.resources,function(ae,ad){var ac=E("<th><div></div></th>").addClass(Z).attr("data-resource",ae).attr("data-date",R.getTime());if(V){E(y[N]).find("tr").prepend(ac)}else{E(y[N]).find("tr").append(ac)}for(S=1;S<=(ad.availability_by==="unit"?ad.quantity:1);S++){var ab=E('<td class="cell"></td>').addClass(Z).attr("data-resource",ae).data("reservations",[]).attr("data-space",S).attr("data-date",R.getTime());if(V){E(I[N]).find("tr:nth-child("+S+")").prepend(ab)}else{E(I[N]).find("tr:nth-child("+S+")").append(ab)}ab.droppable({scope:"reservations",tolerance:"pointer",drop:function(ah,ai){var af=E(this);if(q.getAttribute("data-space")){af=E(q)}var ak=parseInt(ai.draggable.attr("data-id"),10),aj=a/n.width*(ai.position.left-H.left),ag={id:ak,arrival:t.manipulate_date_without_offset(c[ak].arrival,aj*1000),departure:t.manipulate_date_without_offset(c[ak].departure,aj*1000),resource:parseInt(af.attr("data-resource"),10),space:parseInt(af.attr("data-space"),10)};if(M.resources[ag.resource].availability_by!=="unit"||t.check_availability(ag)){t.recursively_remove_reservation(c[ak]);c[ak].arrival=ag.arrival;c[ak].departure=ag.departure;c[ak].resource=ag.resource;c[ak].space=ag.space;c[ak].changed=true;if(c[ak].status==="pending"){c[ak].status="approved"}ai.helper.remove();t.draw_reservations()}else{}},over:function(af,ag){}})}N++});if(V){if(L===0||L.getTime()-(a*1000*10)>R.getTime()){t.load_data(v,L);L=new Date(v.getTime())}}else{if(J.getTime()+(a*1000*10)<R.getTime()){var T=new Date(t.manipulate_date_without_offset(p,a*1000).getTime());t.load_data(J,T);J=T}}}};j.insertAfter("hr.wp-header-end");F.insertAfter("hr.wp-header-end");o.hide();if(a==="86400"){l.setHours(0,0,0,0);d.find(".daily").addClass("active")}else{l.setHours(l.getHours(),0,0,0);d.find(".hourly").addClass("active")}m.init();t.init()})(jQuery,er_timeline_params);