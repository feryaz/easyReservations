(function(C,K){var D=C(".er-timeline-tooltip"),i=C(".er-timeline"),z=C("#timeline-datepicker"),n=i.find("div.sidebar"),g=i.find("div.timeline"),d=i.find("div.header"),E=i.find("div.resources table tbody"),v=d.find(".date"),r=g.find("table"),j=r.find("thead.main tr"),w=r.find("thead:not(.main)"),G=r.find("tbody"),c=[],x=false,k=new Date(),t=new Date(),o=false,F=false,I=false,A=false,h=false,q=false,e=0,b=0,B=true,f=false,y=false,u=false,m={height:32,width:96},p=0,J=0,H=0,a=K.default_interval;d.on("click",".expand-sidebar",function(){n.addClass("expanded").show();C(this).removeClass("expand-sidebar").addClass("contract-sidebar")}).on("click",".contract-sidebar",function(){n.removeClass("expanded").hide(300,"linear");C(this).removeClass("contract-sidebar").addClass("expand-sidebar")}).on("click",".hourly",function(){if(!C(this).hasClass("active")){d.find(".daily").removeClass("active");C(this).addClass("active");t=new Date(x.getTime());a="3600";s.init()}}).on("click",".daily",function(){if(!C(this).hasClass("active")){d.find(".hourly").removeClass("active");C(this).addClass("active");t=new Date(x.getTime());a="86400";s.init()}}).on("click",".pending",function(){l.toggle_pending()}).on("click",".date",function(){l.toggle_calendar()}).on("click",".today",function(){s.jump_to_date(k)});z.bind("change",function(L){s.jump_to_date(C(this).datepicker("getDate"))});j.on("mousedown","th",function(L){f=g.scrollLeft()+L.pageX});C(window).mouseup(function(){j.css("cursor","grab");clearInterval(y);y=false;f=false;s.clear_scroll_add_interval()});i.mousemove(function(L){e=L.pageX;b=L.pageY;if(f&&L.which===1){g.scrollLeft(f-L.pageX<1?1:f-L.pageX);s.set_current_date();if(u===false){j.css("cursor","grabbing");s.start_scroll_add_interval()}}if(p!==L.target){p=L.target;if(p.getAttribute("data-date")){s.highlight_current(new Date(parseInt(L.target.getAttribute("data-date"),10)))}if(p.getAttribute("data-space")){A=C(p).offset().top}else{if(p.getAttribute("data-id")){A=C(p).parent().offset().top}}}}).mouseleave(function(){j.css("cursor","grab");clearInterval(y);y=false;f=false;s.clear_scroll_add_interval()}).on("mousedown",".next",function(){if(y===false){s.add_new_column();s.set_current_date();y=setInterval(function(){s.add_new_column();s.set_current_date()},100)}}).on("mousedown",".prev",function(){if(y===false){s.add_new_column(true);s.set_current_date();y=setInterval(function(){s.add_new_column(true);s.set_current_date()},100)}}).on("click",".resource-handler",function(){var M=C(this).parent().parent().parent().next(),L=M.index()/2-1;if(C(this).hasClass("retracted")){C(this).removeClass("retracted");C(G[L]).show();M.show()}else{C(this).addClass("retracted");C(G[L]).hide();M.hide()}}).on("click",".reservation",function(){var L=parseInt(C(this).attr("data-id"),10);g.find(".reservation.selected").removeClass("selected");C(this).addClass("selected");l.display_reservation(c[L])}).on("keydown",".reservation .title",function(L){if(L.keyCode===13){var M=C(this).parents(".reservation").attr("data-id");c[M].title=C(this).html();C(this).blur();l.display_reservation(c[M]);return false}});n.on("click",".allow-edit",function(){var L=parseInt(C(this).attr("data-reservation-id"),10);if(h){s.update_reservation(L);l.stop_edit(h.id)}h=JSON.parse(JSON.stringify(c[L]));n.find("> .reservation-details .edit-actions").show();s.reservation_allow_edit(g.find('.reservation[data-id="'+L+'"]'));C(this).html(K.i18n_stop_edit).addClass("stop-edit").removeClass("allow-edit")}).on("click",".stop-edit",function(){var L=parseInt(C(this).attr("data-reservation-id"),10);s.update_reservation(L);l.stop_edit(L)}).on("click",".status",function(){if(!C(this).hasClass("reservation-status")){var L=parseInt(C(this).parent().parent().attr("data-reservation-id"),10);c[L].status=C(this).attr("data-status");l.display_reservation(c[L]);s.update_reservation(L)}}).on("click",".snapping",function(){if(C(this).hasClass("enabled")){B=false;C(this).removeClass("enabled")}else{B=true;C(this).addClass("enabled")}}).on("click",".revert",function(){var L=parseInt(C(this).attr("data-reservation-id"),10);s.recursively_remove_reservation(c[L]);g.find('.reservation[data-id="'+L+'"]').remove();h.changed=true;s.add_reservation(h);s.draw_reservations();l.stop_edit(L)});var l={init:function(){if(K.pending&&K.pending.length>0){d.find(".pending").html("<span>"+K.pending.length+"</span>");var L=n.find("> .pending").find(".reservations");L.html("");C.each(K.pending,function(M,O){var N=C('<div class="pending-reservation">'),Q=parseInt(O.resource,10),P=false;O.arrival=new Date(O.arrival);O.departure=new Date(O.departure);if(!O.title){O.title="No title"}N.html("<span>#"+O.id+" "+O.title+"</span>");N.bind("click",function(){s.jump_to_date(O.arrival);if(Q>0){i.find('.resource-handler:not([data-resource="'+O.resource+'"],.retracted)').click()}C.each(K.resources,function(R,T){if(!P&&(Q===0||Q===T.ID)){if(T.availability_by==="unit"){O.resource=T.ID;O.space=1;P=true;return false}else{O.resource=T.ID;for(var S=1;S<=T.quantity;S++){O.space=1;if(s.check_availability(O)){P=true;break}}}}});if(P){O.status="approved";s.add_reservation(O);s.draw_reservations();K.pending.splice(M);C(this).remove();l.init()}});L.append(N)})}else{d.find(".pending").html("");n.find("> .pending").find(".reservations").html(K.i18n_no_pending)}l.display_calendar()},is_open:function(){return n.hasClass("expanded")},open:function(){if(!l.is_open()){d.find(".expand-sidebar").click()}},close:function(){if(l.is_open()){d.find(".contract-sidebar").click()}},toggle:function(){if(l.is_open()){d.find(".contract-sidebar").click();return false}else{d.find(".expand-sidebar").click();return true}},toggle_calendar:function(){if(!n.find("> .calendar").hasClass("visible")){l.display_calendar();l.open()}else{l.toggle()}},toggle_pending:function(){if(!n.find("> .pending").hasClass("visible")){l.display_pending();l.open()}else{l.toggle()}},clear:function(){n.find("> .visible").hide().removeClass("visible")},display_calendar:function(){var L=n.find("> .calendar");l.clear();L.show().addClass("visible")},display_pending:function(){var L=n.find("> .pending");l.clear();L.show().addClass("visible")},stop_edit:function(L){n.find("> .reservation-details .edit-actions").hide();n.find("> .reservation-details .stop-edit").html(K.i18n_allow_edit).removeClass("stop-edit").addClass("allow-edit");if(h){s.reservation_stop_edit(C('.reservation[data-id="'+L+'"]'));h=false}},display_reservation:function(N){var M=n.find("> .reservation-details"),L=M.find(".reservation-header"),O=K.resources[N.resource];L.find(".title").html(N.title);L.find(".reservation-status").attr("class","reservation-status status-"+N.status);M.attr("data-reservation-id",N.id);M.find(".reservation-preview").attr("data-reservation-id",N.id).data("reservation-data",false);M.find(".snapping").removeClass("enabled");M.find(".revert").attr("data-reservation-id",N.id);M.find(".input-box.reservation-status").removeClass("reservation-status");M.find(".input-box.status-"+N.status).addClass("reservation-status");M.find(".reservation-arrival").html(easyFormatDate(N.arrival,"full"));M.find(".reservation-departure").html(easyFormatDate(N.departure,"full"));M.find(".reservation-resource").html(O.post_title);M.find(".reservation-adults").html(N.adults);M.find(".reservation-children").html(N.children);if(h&&h.id===N.id){M.find(".edit-actions").show();M.find(".allow-edit").html(K.i18n_stop_edit).removeClass("allow-edit").addClass("stop-edit");M.find(".stop-edit").attr("data-reservation-id",N.id)}else{M.find(".stop-edit").html(K.i18n_allow_edit).removeClass("stop-edit").addClass("allow-edit");M.find(".allow-edit").attr("data-reservation-id",N.id);M.find(".edit-actions").hide()}if(O.availability_by!=="unit"){M.find(".reservation-space").hide()}else{M.find(".reservation-space").show().html(typeof O.spaces[N.space]==="undefined"?N.space:O.spaces[N.space])}if(N.order_id==="0"){M.find(".reservation-order").html(K.i18n_no_order)}else{M.find(".reservation-order").html(K.i18n_order.replace("%s",'<a href="'+K.order_url.replace("%s",N.order_id)+'" target="_blank">#'+N.order_id+"</a>"))}if(B){M.find(".snapping").addClass("enabled")}l.clear();M.show().addClass("visible");l.open()}};var s={init:function(){k=new Date();c=[];x=false;if(a==="86400"){k.setHours(0,0,0,0);t.setHours(0,0,0,0)}else{k.setHours(k.getHours(),0,0,0);if(k.getDate()===t.getDate()&&k.getMonth()===t.getMonth()&&k.getFullYear()===t.getFullYear()){t.setHours(k.getHours(),0,0,0)}else{t.setHours(0,0,0,0)}}r.find("td,th").remove();t=s.manipulate_date_without_offset(t,(15*a*1000)*-1);H=new Date(t.getTime());J=new Date(t.getTime());for(var L=0;L<50;L++){o=s.manipulate_date_without_offset(t,L*a*1000);s.generate_column(o,false)}s.load_remaining();g.scrollLeft(j.find("th:nth-child(15)").offset().left-g.offset().left+g.scrollLeft()+1);s.set_current_date();s.sync_cell_heights()},manipulate_date_without_offset:function(L,M){var N=new Date(L.getTime()+M);return new Date(N.getTime()+N.getTimezoneOffset()*1000*60-L.getTimezoneOffset()*1000*60)},highlight_current:function(L){r.find("td.hover, th.hover").removeClass("hover");r.find('td[data-date="'+L.getTime()+'"], th[data-date="'+L.getTime()+'"]').addClass("hover")},set_current_date:function(){var L=s.manipulate_date_without_offset(t,((g.scrollLeft()/m.width+1)*a*1000));if(a==="3600"){L.setHours(L.getHours(),0,0,0)}else{L.setHours(0,0,0,0)}if(!x||L.getDate()!==x.getDate()||L.getMonth()!==x.getMonth()||L.getFullYear()!==x.getFullYear()){x=L;if(a==="3600"){v.html(x.getDate()+" "+er_date_picker_params.month_names[x.getMonth()]+" "+x.getFullYear())}else{v.html(er_date_picker_params.month_names[x.getMonth()]+" "+x.getFullYear())}j.find("th.current").removeClass("current");j.find('th[data-date="'+x.getTime()+'"]').addClass("current");z.datepicker("setDate",x)}else{if(a==="3600"&&L.getHours()!==x.getHours()){x=L;j.find("th.current").removeClass("current");j.find('th[data-date="'+x.getTime()+'"]').addClass("current")}}},start_scroll_add_interval:function(){if(u===false&&(g.scrollLeft()<2||g[0].scrollWidth-(g.width()+g.scrollLeft())<2)){u=setInterval(function(){if(u!==false&&(g.scrollLeft()<2||g[0].scrollWidth-(g.width()+g.scrollLeft())<2)){s.add_new_column(g.scrollLeft()<2);s.set_current_date()}},38)}},clear_scroll_add_interval:function(){if(u!==false){clearInterval(u);u=false;s.load_remaining()}},jump_to_date:function(L){if(L<t||L>o){t=L;s.init()}else{var N=(x.getTime()-L.getTime()+L.getTimezoneOffset()*1000*60-x.getTimezoneOffset()*1000*60)/(a*1000);for(var M=1;M<=Math.abs(N);M++){s.add_new_column(N>0)}s.set_current_date()}},add_new_column:function(L){if(L){t=s.manipulate_date_without_offset(t,a*1000*-1);s.generate_column(t,true);r.find("th:last-child,td:last-child").remove();H=s.manipulate_date_without_offset(H,a*1000*-1);o=s.manipulate_date_without_offset(o,a*1000*-1)}else{o=s.manipulate_date_without_offset(o,a*1000);s.generate_column(o,false);r.find("th:first-child").remove();r.find("td:first-child").each(function(){var M=C(this).data("reservations");if(M&&M.length>0){C.each(M,function(N,O){if(c[O]&&typeof c[O]!=="undefined"){c[O].changed=true}})}}).remove();J=s.manipulate_date_without_offset(J,a*1000);t=s.manipulate_date_without_offset(t,a*1000)}s.sync_cell_heights()},load_remaining:function(){if(J===0||J>t){s.load_data(t,J);J=new Date(t.getTime())}else{if(H<o){var L=s.manipulate_date_without_offset(o,a*1000);s.load_data(H,L);H=L}else{}}},load_data:function(M,L){C.ajax({url:K.ajax_url,data:{action:"easyreservations_timeline_data",security:K.nonce,start:M.getDate()+"."+(M.getMonth()+1)+"."+M.getFullYear(),start_hour:M.getHours(),end:L.getDate()+"."+(L.getMonth()+1)+"."+L.getFullYear(),end_hour:L.getHours(),interval:a},type:"POST",success:function(N){if(N.data){C.each(N.data,function(Q,P){var O=K.resources[Q].quantity;C.each(P,function(V,R){var T=new Date(parseInt(V,10)*1000),S="",U;if(R<0){S="unavailable";U=0}else{U=O-R}G.find('td[data-date="'+(T.getTime()+(T.getTimezoneOffset()*1000*60))+'"][data-resource="'+Q+'"]').removeClass("loading").addClass(S);w.find('th[data-date="'+(T.getTime()+(T.getTimezoneOffset()*1000*60))+'"][data-resource="'+Q+'"]').html("<div><span>"+U+"</span></div>").addClass(parseInt(R,10)===O?"unavailable":"")})})}if(N.reservations){C.each(N.reservations,function(O,P){s.add_reservation(P)});s.draw_reservations()}}})},update_reservation:function(M){var L=c[M];C.ajax({url:K.ajax_url,data:{action:"easyreservations_timeline_update_reservation",security:K.nonce,id:M,arrival:easyFormatDate(L.arrival,"full"),departure:easyFormatDate(L.departure,"full"),status:L.status,resource:L.resource,space:L.space,title:L.title},type:"POST",success:function(N){if(N.data){}if(N.reservation){s.add_reservation(N.reservation);s.draw_reservations()}}})},draw_reservations:function(){var L=[],M=true;C.each(c,function(N,O){if(O&&O.changed&&O.status!=="pending"){L.push(O.id)}});L.sort(function(O,N){return c[O].arrival<c[N].arrival?-1:1});C.each(L,function(N,O){if(O){if(!s.draw_reservation(c[O])){s.draw_reservations();M=false;return false}}});if(M&&L.length>0){s.sync_cell_heights()}},recursively_remove_reservation:function(O){var P=parseInt(O.id,10),N=new Date(O.arrival.getTime()),M=new Date(O.departure.getTime());if(a==="86400"){N.setHours(0,0,0);M.setHours(0,0,0)}else{N.setHours(N.getHours(),0,0);M.setHours(M.getHours(),0,0)}while(N<=M){var L=C('td[data-date="'+(N.getTime())+'"][data-resource="'+O.resource+'"][data-space="'+O.space+'"]');if(L.length>0){s.recursively_remove_reservations(L,O.depths,P)}N=s.manipulate_date_without_offset(N,a*1000)}},recursively_remove_reservations:function(M,Q,R){var L=M.data("reservations"),P=[],N=false,O=0;if(L&&L.length>0){C.each(L,function(S,T){if(T){if(T===R||c[T].depths>=Q){if(N===false){N=c[T].depths}N=Math.min(N,c[T].depths);q=true;c[T].changed=true}else{P.push(T);O=Math.max(O,c[T].depths)}}})}M.data("reservations",P);if(N!==false){s.recursively_remove_reservations(M.next(),N,R)}},reservation_stop_edit:function(L){L.draggable("destroy").resizable("destroy");L.find(".title").attr("contenteditable","false")},reservation_allow_edit:function(L){L.draggable({snap:B?false:".reservation",snapTolerance:3,scroll:false,helper:"clone",appendTo:".timeline",stack:".reservation",scope:"reservations",cancel:".title",revert:function(M,N){if(M){return M}C(this).data("uiDraggable").originalPosition={top:F.top-1,left:F.left};return !M},start:function(M,N){F=N.originalPosition;I=N.offset},drag:function(P,Q){var S=parseInt(Q.helper.attr("data-id"),10),M=c[S],R=a/m.width*(Q.position.left-F.left),N=e-g.offset().left;if(B){var O=Math.round((Q.position.left-F.left)/m.width);R=O*a;Q.position.left=F.left+(O*m.width)}D.html(easyFormatTime(s.manipulate_date_without_offset(M.arrival,R*1000))+" - "+easyFormatTime(s.manipulate_date_without_offset(M.departure,R*1000))).css({top:b,left:Math.min(e-130,g.width()),display:"block"});if(A!==false){Q.position.top=A-I.top+F.top}if((N>0&&N<15)||g.width()-N<15){if(y===false){y=setInterval(function(){if(y!==false){var T=e-g.offset().left;if(u===false&&((T>0&&T<15)||g.width()-T<15)){s.add_new_column(T<15);F.left=F.left+(T<15?m.width:m.width*-1)}g.scrollLeft(Math.max(1,g.scrollLeft()+(T<15?m.width*-1:m.width)))}},130)}}else{if(y!==false){clearInterval(y);y=false;s.load_remaining()}}},stop:function(){D.css("display","none");if(y!==false){clearInterval(y);y=false;s.load_remaining()}}}).resizable({handles:"e, w",grid:B?[96,26]:false,maxWidth:m.width*50,scroll:0,minHeight:0,minWidth:4,start:function(M,N){N.originalElement.attr("style","left: "+N.originalElement.css("left")+";top: "+N.originalElement.css("top")+" !important;width: "+N.originalElement.css("width"))},resize:function(P,R){var S=parseInt(R.element.attr("data-id"),10),N=c[S],M=a/m.width*(R.position.left-R.originalPosition.left),Q=a/m.width*(R.size.width+2),O;if(R.position.left-R.originalPosition.left!==0){O=easyFormatTime(s.manipulate_date_without_offset(N.arrival,M*1000))}else{if(R.size.width-R.originalSize.width!==0){O=easyFormatTime(s.manipulate_date_without_offset(N.arrival,Q*1000))}else{O=easyFormatTime(s.manipulate_date_without_offset(N.arrival,M*1000));O+=" - ";O+=easyFormatTime(s.manipulate_date_without_offset(N.arrival,Q*1000))}}D.html(O).css({top:b,left:Math.min(e-130,g.width()),display:"block"})},stop:function(O,Q){var R=parseInt(Q.element.attr("data-id"),10),M=a/m.width*(Q.position.left-Q.originalPosition.left),P=a/m.width*(Q.size.width+2),N={id:R,arrival:s.manipulate_date_without_offset(c[R].arrival,M*1000),departure:s.manipulate_date_without_offset(c[R].arrival,(M*1000)+(P*1000)),resource:c[R].resource,space:c[R].space};if(K.resources[c[R].resource].availability_by!=="unit"||s.check_availability(N)){s.recursively_remove_reservation(c[R]);c[R].arrival=N.arrival;c[R].departure=N.departure;c[R].changed=true;s.draw_reservations()}else{Q.helper.animate({width:Q.originalSize.width,left:Q.originalPosition.left},500,function(){})}D.css("display","none")}});L.find(".title").attr("contenteditable","true")},draw_reservation:function(N){var L=parseInt(N.id,10),O=new Date(N.arrival.getTime()),Q=new Date(N.departure.getTime()),R=C('<div class="reservation">'),M=(N.departure.getTime()-N.arrival.getTime()),T=(((M/1000)/a)*m.width)-2,W=false,X=[],U=0;q=false;if(a==="86400"){O.setHours(0,0,0);Q.setHours(0,0,0)}else{O.setHours(O.getHours(),0,0);Q.setHours(Q.getHours(),0,0)}while(O<=Q){var V=C('td[data-date="'+(O.getTime())+'"][data-resource="'+N.resource+'"][data-space="'+N.space+'"]');if(V&&V.length>0){var S=V.data("reservations");if(S.length>0){C.each(S,function(Y,Z){if(Z&&Z!==L){if(c[Z].arrival>N.arrival&&c[Z].arrival<N.departure&&c[Z].departure>N.arrival){s.recursively_remove_reservations(V,U,Z)}else{if(c[Z].departure<=N.arrival||c[Z].arrival>=N.departure){}else{X[c[Z].depths]=1}}}})}if(W===false){R.css("left",(((N.arrival.getTime()-O.getTime())/1000/a*m.width)-1)+"px");W=V}if(C.inArray(L,S)<0){S.push(L);V.data("reservations",S)}}O=s.manipulate_date_without_offset(O,a*1000)}if(W===false){c[L].changed=false;return true}else{if(q){return false}else{R.html('<span class="wrapper"><span class="sticky"><span class="id">'+L+'</span><div class="title">'+N.title+"</div></span></span>").css("min-width",T+"px").css("max-width",T+"px").css("top","0px").css("position","absolute").addClass(N.status).attr("data-tip",N.id).attr("data-id",N.id);var P=C('.reservation[data-id="'+L+'"]').remove();if(P.length>0){R.addClass("fade-in-fast")}if(h&&h.id===L){l.display_reservation(N);s.reservation_allow_edit(R);g.find(".reservation.selected").removeClass("selected");R.addClass("selected")}W.append(R);while(X[U]===1){U++}if(U>0){if(W.height()<m.height+(m.height-3)*U){W.height(m.height+(m.height-3)*U)}R.css("top",(m.height-3)*U+"px")}N.depths=U;N.changed=false;console.log("did draw "+L+"at depths "+U);c[L]=N}}return W},add_reservation:function(L){var M=parseInt(L.id,10);L.id=M;L.arrival=new Date(L.arrival);L.departure=new Date(L.departure);L.resource=parseInt(L.resource,10);L.space=parseInt(L.space,10);if(typeof c[M]==="undefined"){L.changed=true}else{L.changed=c[M].changed;L.depths=c[M].depths}c[M]=L},check_availability:function(L){var N=parseInt(L.id,10),M=true;C.each(c,function(O,P){if(P&&P.resource===L.resource&&P.space===L.space&&P.id!==N&&(L.arrival<P.departure&&L.departure>P.arrival)){M=false;return false}});return M},sync_cell_heights:function(){var L,M;E.each(function(N,O){L=C(O).index()/2-1;C(O).children().each(function(P,Q){M=C(Q).index();C(Q).height(C(G[L]).children().eq(C(Q).index()).height())})})},generate_column:function(P,T){var N,X="",L=0,Q=0,U=P.getDay()===0?6:P.getDay()-1;if(a==="86400"){N=C('<th><div class="date"><span>'+easyFormatDate(P,"d")+"</span><div>"+er_date_picker_params.day_names_min[U]+"</div></div></th>");if(P.getDate()===1){N.append(C('<div class="first-of-month"></div>'))}}else{var Y=er_both_params.time_format.charAt(er_both_params.time_format.length-1),V=easyAddZero(P.getMinutes());if(Y==="a"){V=P.getHours()>=12?"pm":"am"}else{if(Y==="a"){V=P.getHours()>=12?"PM":"AM"}}N=C('<th><div class="date"><span>'+easyFormatDate(P,"H")+"</span><div>"+V+"</div></div></th>");if(P.getHours()===0){N.append(C('<div class="first-of-month"></div>'))}}if(P.getDate()===k.getDate()&&P.getMonth()===k.getMonth()&&P.getFullYear()===k.getFullYear()&&(a==="86400"||P.getHours()===k.getHours())){var W=C('<div class="today"></div>'),M=C('<div class="overlay"></div>'),S=new Date(),O;if(a==="86400"){O=m.width/86400*(S.getHours()*3600+S.getMinutes()*60)-1}else{O=m.width/3600*(S.getMinutes()*60)-1}W.css("left",O);M.css("left",O).css("width",O).css("margin-left",-O);N.append(W).append(M);X+=" today"}else{if(P<k){X+=" past"}}if(a==="86400"&&(P.getDay()===0||P.getDay()===6)){X+=" weekend"}N.addClass(X).attr("data-date",P.getTime());X+=" loading";if(T){j.prepend(N)}else{j.append(N)}C.each(K.resources,function(ac,ab){var aa=C("<th><div></div></th>").addClass(X).attr("data-resource",ac).attr("data-date",P.getTime());if(T){C(w[L]).find("tr").prepend(aa)}else{C(w[L]).find("tr").append(aa)}for(Q=1;Q<=(ab.availability_by==="unit"?ab.quantity:1);Q++){var Z=C('<td class="cell"></td>').addClass(X).attr("data-resource",ac).data("reservations",[]).attr("data-space",Q).attr("data-date",P.getTime());if(T){C(G[L]).find("tr:nth-child("+Q+")").prepend(Z)}else{C(G[L]).find("tr:nth-child("+Q+")").append(Z)}Z.droppable({scope:"reservations",tolerance:"pointer",drop:function(af,ag){var ad=C(this);if(p.getAttribute("data-space")){ad=C(p)}var ai=parseInt(ag.draggable.attr("data-id"),10),ah=a/m.width*(ag.position.left-F.left),ae={id:ai,arrival:s.manipulate_date_without_offset(c[ai].arrival,ah*1000),departure:s.manipulate_date_without_offset(c[ai].departure,ah*1000),resource:parseInt(ad.attr("data-resource"),10),space:parseInt(ad.attr("data-space"),10)};if(K.resources[ae.resource].availability_by!=="unit"||s.check_availability(ae)){s.recursively_remove_reservation(c[ai]);c[ai].arrival=ae.arrival;c[ai].departure=ae.departure;c[ai].resource=ae.resource;c[ai].space=ae.space;c[ai].changed=true;if(c[ai].status==="pending"){c[ai].status="approved"}ag.helper.remove();s.draw_reservations()}else{}},over:function(ad,ae){}})}L++});if(T){if(J===0||J.getTime()-(a*1000*10)>P.getTime()){s.load_data(t,J);J=new Date(t.getTime())}}else{if(H.getTime()+(a*1000*10)<P.getTime()){var R=new Date(s.manipulate_date_without_offset(o,a*1000).getTime());s.load_data(H,R);H=R}}}};i.insertAfter("hr.wp-header-end");D.insertAfter("hr.wp-header-end");n.hide();if(a==="86400"){k.setHours(0,0,0,0);d.find(".daily").addClass("active")}else{k.setHours(k.getHours(),0,0,0);d.find(".hourly").addClass("active")}l.init();s.init()})(jQuery,er_timeline_params);