(function(F,O){var H=F(".er-timeline-tooltip"),j=F(".er-timeline"),C=F("#timeline-datepicker"),o=j.find("div.sidebar"),g=j.find("div.timeline"),d=j.find("div.header"),I=j.find("div.resources table tbody"),x=d.find(".date"),s=g.find("table"),k=s.find("thead.main tr"),y=s.find("thead:not(.main)"),K=s.find("tbody"),c=[],z=false,l=new Date(),v=new Date(),p=false,J=false,M=false,D=false,h=false,G=false,r=false,e=0,b=0,E=true,f=false,A=false,w=false,n={height:32,width:96},B=false,q=0,N=0,L=0,u=parseInt(O.first_hour,10),i=parseInt(O.last_hour,10),a=O.default_interval;d.on("click",".expand-sidebar",function(){o.addClass("expanded").show();F(this).removeClass("expand-sidebar").addClass("contract-sidebar")}).on("click",".contract-sidebar",function(){o.removeClass("expanded").hide(300,"linear");F(this).removeClass("contract-sidebar").addClass("expand-sidebar")}).on("click",".hourly",function(){if(!F(this).hasClass("active")){g.addClass("hourly");d.find(".daily").removeClass("active");F(this).addClass("active");v=new Date(z.getTime());a="3600";t.init()}}).on("click",".daily",function(){if(!F(this).hasClass("active")){g.removeClass("hourly");d.find(".hourly").removeClass("active");F(this).addClass("active");v=new Date(z.getTime());a="86400";t.init()}}).on("click",".pending",function(){m.toggle_pending()}).on("click",".date",function(){m.toggle_calendar()}).on("click",".today",function(){t.jump_to_date(l)}).on("click","a.start-add",function(){G=F(this).attr("data-target")}).on("click",".cancel-add",function(){G=false});C.bind("change",function(P){t.jump_to_date(F(this).datepicker("getDate"))});k.on("mousedown","th",function(P){f=g.scrollLeft()+P.pageX});F(window).mouseup(function(S){k.css("cursor","grab");clearInterval(A);A=false;f=false;t.clear_scroll_add_interval();H.css("display","none");if(B){var R=B.attr("data-direction"),T=new Date(parseInt(B.attr("data-start"),10)),Q=t.manipulate_date_without_offset(T,(parseInt(B.css("width"),10)/n.width*a*1000)*(R==="left"?-1:1)),P={add:G,arrival:easyFormatDate(T<Q?T:Q,"full"),departure:easyFormatDate(Q>T?Q:T,"full"),resource:parseInt(B.attr("data-resource"),10),space:parseInt(B.attr("data-space"),10)};if(a==="86400"){T.setHours(0,0,0,0);Q.setHours(0,0,0,0)}else{T.setHours(T.getHours(),0,0,0);Q.setHours(Q.getHours(),0,0,0)}if(Q>T){Q=t.manipulate_date_without_offset(Q,a*1000)}else{T=t.manipulate_date_without_offset(T,a*1000)}t.load_data(T<Q?T:Q,Q>T?Q:T,P);B.remove();B=false;G=false}});j.on("mousedown",".next",function(){if(A===false){t.add_new_column();t.set_current_date();A=setInterval(function(){t.add_new_column();t.set_current_date()},100)}}).on("mousedown",".prev",function(){if(A===false){t.add_new_column(true);t.set_current_date();A=setInterval(function(){t.add_new_column(true);t.set_current_date()},100)}});g.mousemove(function(S){e=S.pageX;b=S.pageY;if(f&&S.which===1){g.scrollLeft(f-S.pageX<1?1:f-S.pageX);t.set_current_date();if(w===false){k.css("cursor","grabbing");t.start_scroll_add_interval()}}if(B){var R=-J.left+e-parseInt(B.attr("data-pageX"),10),T=new Date(parseInt(B.attr("data-start"),10)),U=(R)/n.width*a,Q="",P="";if(-J.left+R>0){B.attr("data-direction","right").css("margin-left",J.left).css("width",R+(-J.left));Q=easyFormatTime(T);P=easyFormatTime(t.manipulate_date_without_offset(T,U*1000))}else{B.attr("data-direction","left").css("margin-left",R).css("width",(-R)+J.left);Q=easyFormatTime(t.manipulate_date_without_offset(T,U*1000));P=easyFormatTime(T)}H.html(Q+" - "+P).css({top:b,left:Math.min(e-130,g.width()),display:"block"});t.scroll_dragging()}else{if(G&&S.target.getAttribute("data-space")){H.html(easyFormatTime(t.manipulate_date_without_offset(v,a/n.width*Math.floor(S.target.offsetLeft+S.offsetX)*1000))).css({top:b,left:Math.min(e-130,g.width()),display:"block"})}}if(q!==S.target){q=S.target;if(q.getAttribute("data-resource")){t.highlight_current(new Date(parseInt(S.target.getAttribute("data-date"),10)),parseInt(S.target.getAttribute("data-resource"),10),parseInt(S.target.getAttribute("data-space"),10))}else{k.find("th.hover").removeClass("hover")}if(q.getAttribute("data-space")){D=F(q).offset().top}else{if(q.getAttribute("data-id")){D=F(q).parent().offset().top}}}}).mouseleave(function(){k.css("cursor","grab");k.find("th.hover").removeClass("hover");I.find("td.hover").removeClass("hover");clearInterval(A);A=false;f=false;q=false;H.css("display","none");t.clear_scroll_add_interval()}).on("mousedown",".cell",function(R){if(G){var Q=t.manipulate_date_without_offset(new Date(parseInt(F(this).attr("data-date"),10)),a/(n.width)*Math.floor(R.offsetX)*1000),P=this;B=F('<div class="placeholder">');J={top:0,left:0};if(G==="resource"){P=this.parentNode.parentNode}else{if(G==="global"){P=this.parentNode.parentNode.parentNode}}B.css("top",P.offsetTop).css("left",this.offsetLeft+R.offsetX).css("height",F(P).height()).attr("data-pageX",R.pageX).attr("data-resource",F(this).attr("data-resource")).attr("data-space",F(this).attr("data-space")).attr("data-start",Q.getTime());g.append(B)}}).on("click",".resource-handler",function(){var Q=F(this).parent().parent().parent().next(),P=Q.index()/2-1;if(F(this).hasClass("retracted")){F(this).removeClass("retracted");F(K[P]).show();Q.show()}else{F(this).addClass("retracted");F(K[P]).hide();Q.hide()}}).on("click",".reservation",function(){var P=parseInt(F(this).attr("data-id"),10);g.find(".reservation.selected").removeClass("selected");F(this).addClass("selected");m.display_reservation(c[P])}).on("keydown",".reservation .title",function(P){if(P.keyCode===13){var Q=F(this).parents(".reservation").attr("data-id");c[Q].title=F(this).html();F(this).blur();m.display_reservation(c[Q]);return false}});o.on("click",".allow-edit",function(){var P=parseInt(F(this).attr("data-reservation-id"),10);if(h){t.update_reservation(P);m.stop_edit(h.id)}h=JSON.parse(JSON.stringify(c[P]));G=false;o.find("> .reservation-details .edit-actions").show();t.reservation_allow_edit(g.find('.reservation[data-id="'+P+'"]'));F(this).html(O.i18n_stop_edit).addClass("stop-edit").removeClass("allow-edit")}).on("click",".stop-edit",function(){var P=parseInt(F(this).attr("data-reservation-id"),10);t.update_reservation(P);m.stop_edit(P)}).on("click",".status",function(){if(!F(this).hasClass("reservation-status")){var Q=parseInt(F(this).parent().parent().attr("data-reservation-id"),10),P=F(this).attr("data-status");c[Q].status=P;g.find('.reservation[data-id="'+Q+'"]').removeClass("approved checked completed").addClass(P);m.display_reservation(c[Q]);t.update_reservation(Q)}}).on("click",".snapping",function(){if(F(this).hasClass("enabled")){E=false;F(this).removeClass("enabled")}else{E=true;F(this).addClass("enabled")}}).on("click",".revert",function(){var P=parseInt(F(this).attr("data-reservation-id"),10);t.recursively_remove_reservation(c[P]);g.find('.reservation[data-id="'+P+'"]').remove();h.changed=true;t.add_reservation(h);t.draw_reservations();m.stop_edit(P)});var m={init:function(){if(O.pending&&O.pending.length>0){d.find(".pending").html("<span>"+O.pending.length+"</span>");var P=o.find("> .pending").find(".reservations");P.html("");F.each(O.pending,function(Q,S){var R=F('<div class="pending-reservation">'),U=parseInt(S.resource,10),T=false;S.arrival=new Date(S.arrival);S.departure=new Date(S.departure);if(!S.title){S.title="No title"}R.html("<span>#"+S.id+" "+S.title+"</span>");R.bind("click",function(){t.jump_to_date(S.arrival);if(U>0){j.find('.resource-handler:not([data-resource="'+S.resource+'"],.retracted)').click()}F.each(O.resources,function(V,X){if(!T&&(U===0||U===X.ID)){if(X.availability_by==="unit"){S.resource=X.ID;S.space=1;T=true;return false}else{S.resource=X.ID;for(var W=1;W<=X.quantity;W++){S.space=1;if(t.check_availability(S)){T=true;break}}}}});if(T){S.status="approved";t.add_reservation(S);t.draw_reservations();O.pending.splice(Q);F(this).remove();m.init()}});P.append(R)})}else{d.find(".pending").html("");o.find("> .pending").find(".reservations").html(O.i18n_no_pending)}m.display_calendar()},is_open:function(){return o.hasClass("expanded")},open:function(){if(!m.is_open()){d.find(".expand-sidebar").click()}},close:function(){if(m.is_open()){d.find(".contract-sidebar").click()}},toggle:function(){if(m.is_open()){d.find(".contract-sidebar").click();return false}else{d.find(".expand-sidebar").click();return true}},toggle_calendar:function(){if(!o.find("> .calendar").hasClass("visible")){m.display_calendar();m.open()}else{m.toggle()}},toggle_pending:function(){if(!o.find("> .pending").hasClass("visible")){m.display_pending();m.open()}else{m.toggle()}},clear:function(){o.find("> .visible").hide().removeClass("visible")},display_calendar:function(){var P=o.find("> .calendar");m.clear();P.show().addClass("visible")},display_pending:function(){var P=o.find("> .pending");m.clear();P.show().addClass("visible")},stop_edit:function(P){o.find("> .reservation-details .edit-actions").hide();o.find("> .reservation-details .stop-edit").html(O.i18n_allow_edit).removeClass("stop-edit").addClass("allow-edit");if(h){t.reservation_stop_edit(F('.reservation[data-id="'+P+'"]'));h=false}},display_reservation:function(R){var Q=o.find("> .reservation-details"),P=Q.find(".reservation-header"),S=O.resources[R.resource];P.find(".title").html(R.title);P.find(".reservation-status").attr("class","reservation-status status-"+R.status);Q.attr("data-reservation-id",R.id);Q.find(".reservation-preview").attr("data-reservation-id",R.id).data("reservation-data",false);Q.find(".snapping").removeClass("enabled");Q.find(".revert").attr("data-reservation-id",R.id);Q.find(".input-box.reservation-status").removeClass("reservation-status");Q.find(".input-box.status-"+R.status).addClass("reservation-status");Q.find(".reservation-arrival").html(easyFormatDate(R.arrival,"full"));Q.find(".reservation-departure").html(easyFormatDate(R.departure,"full"));Q.find(".reservation-resource").html(S.post_title);Q.find(".reservation-adults").html(R.adults);Q.find(".reservation-children").html(R.children);if(h&&h.id===R.id){Q.find(".edit-actions").show();Q.find(".allow-edit").html(O.i18n_stop_edit).removeClass("allow-edit").addClass("stop-edit");Q.find(".stop-edit").attr("data-reservation-id",R.id)}else{Q.find(".stop-edit").html(O.i18n_allow_edit).removeClass("stop-edit").addClass("allow-edit");Q.find(".allow-edit").attr("data-reservation-id",R.id);Q.find(".edit-actions").hide()}if(S.availability_by!=="unit"){Q.find(".reservation-space").hide()}else{Q.find(".reservation-space").show().html(typeof S.spaces[R.space]==="undefined"?R.space:S.spaces[R.space])}if(R.order_id==="0"){Q.find(".reservation-order").html(O.i18n_no_order)}else{Q.find(".reservation-order").html(O.i18n_order.replace("%s",'<a href="'+O.order_url.replace("%s",R.order_id)+'" target="_blank">#'+R.order_id+"</a>"))}if(E){Q.find(".snapping").addClass("enabled")}m.clear();Q.show().addClass("visible");m.open()}};var t={init:function(){l=new Date();c=[];z=false;if(a==="86400"){n.width=96;l.setHours(0,0,0,0);v.setHours(0,0,0,0)}else{n.width=48;l.setHours(l.getHours(),0,0,0);if(l.getDate()===v.getDate()&&l.getMonth()===v.getMonth()&&l.getFullYear()===v.getFullYear()){v.setHours(l.getHours(),0,0,0)}else{v.setHours(0,0,0,0)}}s.find("td,th").remove();v=t.manipulate_date_without_offset(v,(15*a*1000)*-1);p=new Date(v.getTime());L=new Date(v.getTime());N=new Date(v.getTime());for(var P=0;P<50;P++){t.generate_column(p,false);if(P<49){p=t.manipulate_date_without_offset(p,a*1000)}}t.load_remaining();g.scrollLeft(k.find('th[data-date="'+l.getTime()+'"]').offset().left-g.offset().left+g.scrollLeft()+1);t.set_current_date();t.sync_cell_heights()},manipulate_date_without_offset:function(Q,R){var S=new Date(Q.getTime()+R);if(a==="3600"&&1==2){if(S.getHours()<u){if(R>=0){S=new Date(S.getTime()+(u*3600000-(S.getHours()*3600000+S.getMinutes()*60000)))}else{S=new Date(S.getTime()-(S.getHours()*3600000+S.getMinutes()*60000)-86400000+i*3600000)}}else{if(S.getHours()>i){if(R>=0){S=new Date(S.getTime()+86400000-(S.getHours()*3600000+S.getMinutes()*60000)+u*3600000)}else{S.setHours(i,0,0,0)}}}if(Math.abs(R)>3600000){var P=Math.floor(R/86400000);S=new Date(S.getTime()-(P*((u-1)*3600000)+P*(86400000-i*3600000)))}else{if(Math.abs(R)>3600000){var P=Math.floor(R/3600000);S=new Date(S.getTime()+(P*((u-1)*3600000)+P*(86400000-i*3600000)))}}}return new Date(S.getTime()+S.getTimezoneOffset()*1000*60-Q.getTimezoneOffset()*1000*60)},highlight_current:function(P,R,Q){k.find("th.hover").removeClass("hover");k.find('th[data-date="'+P.getTime()+'"]').addClass("hover");I.find("td.hover, th.hover").removeClass("hover");if(Q){I.find('td[data-resource="'+R+'"][data-space="'+Q+'"]').addClass("hover")}else{I.find('th[data-resource="'+R+'"]').addClass("hover")}},set_current_date:function(){var P=t.manipulate_date_without_offset(v,((Math.round(g.scrollLeft()/n.width)+1)*a*1000));if(a==="3600"){P.setHours(P.getHours(),0,0,0)}else{P.setHours(0,0,0,0)}if(!z||P.getDate()!==z.getDate()||P.getMonth()!==z.getMonth()||P.getFullYear()!==z.getFullYear()){z=P;if(a==="3600"){x.html(z.getDate()+" "+er_date_picker_params.month_names[z.getMonth()]+" "+z.getFullYear())}else{x.html(er_date_picker_params.month_names[z.getMonth()]+" "+z.getFullYear())}k.find("th.current").removeClass("current");k.find('th[data-date="'+z.getTime()+'"]').addClass("current");C.datepicker("setDate",z)}else{if(a==="3600"&&P.getHours()!==z.getHours()){z=P;k.find("th.current").removeClass("current");k.find('th[data-date="'+z.getTime()+'"]').addClass("current")}}},scroll_dragging:function(){var P=e-g.offset().left;if((P>0&&P<15)||g.width()-P<15){if(A===false){A=setInterval(function(){if(A!==false){var Q=e-g.offset().left;if(w===false&&((Q>0&&Q<15)||g.width()-Q<15)){t.add_new_column(Q<15);J.left=J.left+(Q<15?n.width:n.width*-1)}g.scrollLeft(Math.max(1,g.scrollLeft()+(Q<15?n.width*-1:n.width)))}},130)}}else{if(A!==false){clearInterval(A);A=false;t.load_remaining()}}},start_scroll_add_interval:function(){if(w===false&&(g.scrollLeft()<2||g[0].scrollWidth-(g.width()+g.scrollLeft())<2)){w=setInterval(function(){if(w!==false&&(g.scrollLeft()<2||g[0].scrollWidth-(g.width()+g.scrollLeft())<2)){t.add_new_column(g.scrollLeft()<2);t.set_current_date()}},38)}},clear_scroll_add_interval:function(){if(w!==false){clearInterval(w);w=false;t.load_remaining()}},jump_to_date:function(P){if(P<v||P>p){v=P;t.init()}else{var R=(z.getTime()-P.getTime()+P.getTimezoneOffset()*1000*60-z.getTimezoneOffset()*1000*60)/(a*1000);for(var Q=1;Q<=Math.abs(R);Q++){t.add_new_column(R>0)}t.set_current_date()}},add_new_column:function(P){if(P){v=t.manipulate_date_without_offset(v,a*1000*-1);t.generate_column(v,true);s.find("th:last-child,td:last-child").remove();L=t.manipulate_date_without_offset(L,a*1000*-1);p=t.manipulate_date_without_offset(p,a*1000*-1)}else{p=t.manipulate_date_without_offset(p,a*1000);t.generate_column(p,false);s.find("th:first-child").remove();s.find("td:first-child").each(function(){var Q=F(this).data("reservations");if(Q&&Q.length>0){F.each(Q,function(R,S){if(c[S]&&typeof c[S]!=="undefined"){c[S].changed=true}})}}).remove();N=t.manipulate_date_without_offset(N,a*1000);v=t.manipulate_date_without_offset(v,a*1000)}t.sync_cell_heights()},load_remaining:function(){if(N===0||N>v){t.load_data(v,N);N=new Date(v.getTime())}else{if(L<p){var P=t.manipulate_date_without_offset(p,a*1000);t.load_data(L,P);L=P}else{}}},load_data:function(R,P,Q){F.ajax({url:O.ajax_url,data:F.extend({action:"easyreservations_timeline_data",security:O.nonce,start:R.getDate()+"."+(R.getMonth()+1)+"."+R.getFullYear(),start_hour:R.getHours(),end:P.getDate()+"."+(P.getMonth()+1)+"."+P.getFullYear(),end_hour:P.getHours(),interval:a},Q),type:"POST",success:function(S){if(S.data){F.each(S.data,function(V,U){var T=O.resources[V].quantity;F.each(U,function(aa,W){var Y=new Date(parseInt(aa,10)*1000),X="",Z;if(W<0){X="unavailable";Z=0}else{Z=T-W}K.find('td[data-date="'+(Y.getTime()+(Y.getTimezoneOffset()*1000*60))+'"][data-resource="'+V+'"]').removeClass("loading").addClass(X);y.find('th[data-date="'+(Y.getTime()+(Y.getTimezoneOffset()*1000*60))+'"][data-resource="'+V+'"]').html("<div><span>"+Z+"</span></div>").addClass(parseInt(W,10)===T?"unavailable":"")})})}if(S.reservations){F.each(S.reservations,function(T,U){t.add_reservation(U)});t.draw_reservations()}}})},update_reservation:function(Q){var P=c[Q];F.ajax({url:O.ajax_url,data:{action:"easyreservations_timeline_update_reservation",security:O.nonce,id:Q,arrival:easyFormatDate(P.arrival,"full"),departure:easyFormatDate(P.departure,"full"),status:P.status,resource:P.resource,space:P.space,title:P.title},type:"POST",success:function(R){if(R.data){}if(R.reservation){t.add_reservation(R.reservation);t.draw_reservations()}}})},draw_reservations:function(){var P=[],Q=true;F.each(c,function(R,S){if(S&&S.changed&&S.status!=="pending"){P.push(S.id)}});P.sort(function(S,R){return c[S].arrival<c[R].arrival?-1:1});F.each(P,function(R,S){if(S){if(!t.draw_reservation(c[S])){t.draw_reservations();Q=false;return false}}});if(Q&&P.length>0){t.sync_cell_heights()}},recursively_remove_reservation:function(S){var T=parseInt(S.id,10),R=new Date(S.arrival.getTime()),Q=new Date(S.departure.getTime());if(a==="86400"){R.setHours(0,0,0);Q.setHours(0,0,0)}else{R.setHours(R.getHours(),0,0);Q.setHours(Q.getHours(),0,0)}while(R<=Q){var P=F('td[data-date="'+(R.getTime())+'"][data-resource="'+S.resource+'"][data-space="'+S.space+'"]');if(P.length>0){t.recursively_remove_reservations(P,S.depths,T)}R=t.manipulate_date_without_offset(R,a*1000)}},recursively_remove_reservations:function(Q,U,V){var P=Q.data("reservations"),T=[],R=false,S=0;if(P&&P.length>0){F.each(P,function(W,X){if(X){if(X===V||c[X].depths>=U){if(R===false){R=c[X].depths}R=Math.min(R,c[X].depths);r=true;c[X].changed=true}else{T.push(X);S=Math.max(S,c[X].depths)}}})}Q.data("reservations",T);if(R!==false){t.recursively_remove_reservations(Q.next(),R,V)}},reservation_stop_edit:function(P){P.draggable("destroy").resizable("destroy");P.find(".title").attr("contenteditable","false")},reservation_allow_edit:function(P){P.draggable({snap:E?false:".reservation",snapTolerance:3,scroll:false,helper:"clone",appendTo:".timeline",stack:".reservation",scope:"reservations",cancel:".title",revert:function(Q,R){if(Q){return Q}F(this).data("uiDraggable").originalPosition={top:J.top-1,left:J.left};return !Q},start:function(Q,R){J=R.originalPosition;M=R.offset},drag:function(S,T){var V=parseInt(T.helper.attr("data-id"),10),Q=c[V],U=a/n.width*(T.position.left-J.left);if(E){var R=Math.round((T.position.left-J.left)/n.width);U=R*a;T.position.left=J.left+(R*n.width)}H.html(easyFormatTime(t.manipulate_date_without_offset(Q.arrival,U*1000))+" - "+easyFormatTime(t.manipulate_date_without_offset(Q.departure,U*1000))).css({top:b,left:Math.min(e-130,g.width()),display:"block"});if(D!==false){T.position.top=D-M.top+J.top}t.scroll_dragging()},stop:function(){H.css("display","none");if(A!==false){clearInterval(A);A=false;t.load_remaining()}}}).resizable({handles:"e, w",grid:E?[96,26]:false,maxWidth:n.width*50,scroll:0,minHeight:0,minWidth:4,start:function(Q,R){R.originalElement.attr("style","left: "+R.originalElement.css("left")+";top: "+R.originalElement.css("top")+" !important;width: "+R.originalElement.css("width"))},resize:function(T,V){var W=parseInt(V.element.attr("data-id"),10),R=c[W],Q=a/n.width*(V.position.left-V.originalPosition.left),U=a/n.width*(V.size.width+2),S;if(V.position.left-V.originalPosition.left!==0){S=easyFormatTime(t.manipulate_date_without_offset(R.arrival,Q*1000))}else{if(V.size.width-V.originalSize.width!==0){S=easyFormatTime(t.manipulate_date_without_offset(R.arrival,U*1000))}else{S=easyFormatTime(t.manipulate_date_without_offset(R.arrival,Q*1000));S+=" - ";S+=easyFormatTime(t.manipulate_date_without_offset(R.arrival,U*1000))}}H.html(S).css({top:b,left:Math.min(e-130,g.width()),display:"block"})},stop:function(S,U){var V=parseInt(U.element.attr("data-id"),10),Q=a/n.width*(U.position.left-U.originalPosition.left),T=a/n.width*(U.size.width+2),R={id:V,arrival:t.manipulate_date_without_offset(c[V].arrival,Q*1000),departure:t.manipulate_date_without_offset(c[V].arrival,(Q*1000)+(T*1000)),resource:c[V].resource,space:c[V].space};if(O.resources[c[V].resource].availability_by!=="unit"||t.check_availability(R)){t.recursively_remove_reservation(c[V]);c[V].arrival=R.arrival;c[V].departure=R.departure;c[V].changed=true;t.draw_reservations()}else{U.helper.animate({width:U.originalSize.width,left:U.originalPosition.left},500,function(){})}H.css("display","none")}});P.find(".title").attr("contenteditable","true")},draw_reservation:function(R){var P=parseInt(R.id,10),S=new Date(R.arrival.getTime()),U=new Date(R.departure.getTime()),V=F('<div class="reservation">'),Q=t.manipulate_date_without_offset(R.arrival,R.departure.getTime()-R.arrival.getTime()).getTime()-t.manipulate_date_without_offset(R.arrival,0).getTime(),X=(((Q/1000)/a)*n.width)-2,aa=false,ab=[],Y=0;r=false;if(a==="86400"){S.setHours(0,0,0);U.setHours(0,0,0)}else{S.setHours(S.getHours(),0,0);U.setHours(U.getHours(),0,0)}while(S<=U){var Z=F('td[data-date="'+(S.getTime())+'"][data-resource="'+R.resource+'"][data-space="'+R.space+'"]');if(Z&&Z.length>0){var W=Z.data("reservations");if(W.length>0){F.each(W,function(ac,ad){if(ad&&ad!==P){if(c[ad].arrival>R.arrival&&c[ad].arrival<R.departure&&c[ad].departure>R.arrival){t.recursively_remove_reservations(Z,Y,ad)}else{if(c[ad].departure<=R.arrival||c[ad].arrival>=R.departure){}else{ab[c[ad].depths]=1}}}})}if(aa===false){V.css("left",(((t.manipulate_date_without_offset(R.arrival,0)-S.getTime())/1000/a*n.width)-1)+"px");aa=Z}if(F.inArray(P,W)<0){W.push(P);Z.data("reservations",W)}}S=t.manipulate_date_without_offset(S,a*1000)}if(aa===false){c[P].changed=false;return true}else{if(r){return false}else{V.html('<span class="wrapper"><span class="sticky"><span class="id">'+P+'</span><div class="title">'+R.title+"</div></span></span>").css("min-width",X+"px").css("max-width",X+"px").css("top","0px").css("position","absolute").addClass(R.status).attr("data-tip",R.id).attr("data-id",R.id);var T=F('.reservation[data-id="'+P+'"]').remove();if(T.length>0){V.addClass("fade-in-fast")}if(h&&h.id===P){m.display_reservation(R);t.reservation_allow_edit(V);g.find(".reservation.selected").removeClass("selected");V.addClass("selected")}aa.append(V);while(ab[Y]===1){Y++}if(Y>0){if(aa.height()<n.height+(n.height-3)*Y){aa.height(n.height+(n.height-3)*Y)}V.css("top",(n.height-3)*Y+"px")}R.depths=Y;R.changed=false;console.log("did draw "+P+"at depths "+Y);c[P]=R}}return aa},add_reservation:function(P){var Q=parseInt(P.id,10);P.id=Q;P.arrival=new Date(P.arrival);P.departure=new Date(P.departure);P.resource=parseInt(P.resource,10);P.space=parseInt(P.space,10);if(typeof c[Q]==="undefined"){P.changed=true}else{P.changed=c[Q].changed;P.depths=c[Q].depths}c[Q]=P},check_availability:function(P){var R=parseInt(P.id,10),Q=true;F.each(c,function(S,T){if(T&&T.resource===P.resource&&T.space===P.space&&T.id!==R&&(P.arrival<T.departure&&P.departure>T.arrival)){Q=false;return false}});return Q},sync_cell_heights:function(){var P,Q;I.each(function(R,S){P=F(S).index()/2-1;F(S).children().each(function(T,U){Q=F(U).index();F(U).height(F(K[P]).children().eq(F(U).index()).height())})})},generate_column:function(T,X){var R,ab="",P=0,U=0,Y=T.getDay()===0?6:T.getDay()-1;if(a==="86400"){R=F('<th><div class="date"><span>'+easyFormatDate(T,"d")+"</span><div>"+er_date_picker_params.day_names_min[Y]+"</div></div></th>");if(T.getDate()===1){R.append(F('<div class="first-of-month"></div>'))}}else{var ac=er_both_params.time_format.charAt(er_both_params.time_format.length-1),Z=easyAddZero(T.getMinutes());if(ac==="a"){Z=T.getHours()>=12?"pm":"am"}else{if(ac==="a"){Z=T.getHours()>=12?"PM":"AM"}}R=F('<th><div class="date"><span>'+easyFormatDate(T,"H")+"</span><div>"+Z+"</div></div></th>");if(T.getHours()===u){R.append(F('<div class="first-of-month"></div>'))}}if(T.getDate()===l.getDate()&&T.getMonth()===l.getMonth()&&T.getFullYear()===l.getFullYear()&&(a==="86400"||T.getHours()===l.getHours())){var aa=F('<div class="today"></div>'),Q=F('<div class="overlay"></div>'),W=new Date(),S;if(a==="86400"){S=n.width/86400*(W.getHours()*3600+W.getMinutes()*60)-1}else{S=n.width/3600*(W.getMinutes()*60)-1}aa.css("left",S);Q.css("left",S).css("width",S).css("margin-left",-S);R.append(aa).append(Q);ab+=" today"}else{if(T<l){ab+=" past"}}if(a==="86400"&&(T.getDay()===0||T.getDay()===6)){ab+=" weekend"}R.addClass(ab).attr("data-date",T.getTime());ab+=" loading";if(X){k.prepend(R)}else{k.append(R)}F.each(O.resources,function(ag,af){var ae=F("<th><div></div></th>").addClass(ab).attr("data-resource",ag).attr("data-date",T.getTime());if(X){F(y[P]).find("tr").prepend(ae)}else{F(y[P]).find("tr").append(ae)}for(U=1;U<=(af.availability_by==="unit"?af.quantity:1);U++){var ad=F('<td class="cell"></td>').addClass(ab).attr("data-resource",ag).data("reservations",[]).attr("data-space",U).attr("data-date",T.getTime());if(X){F(K[P]).find("tr:nth-child("+U+")").prepend(ad)}else{F(K[P]).find("tr:nth-child("+U+")").append(ad)}ad.droppable({scope:"reservations",tolerance:"pointer",drop:function(aj,ak){var ah=F(this);if(q.getAttribute("data-space")){ah=F(q)}var am=parseInt(ak.draggable.attr("data-id"),10),al=a/n.width*(ak.position.left-J.left),ai={id:am,arrival:t.manipulate_date_without_offset(c[am].arrival,al*1000),departure:t.manipulate_date_without_offset(c[am].departure,al*1000),resource:parseInt(ah.attr("data-resource"),10),space:parseInt(ah.attr("data-space"),10)};if(O.resources[ai.resource].availability_by!=="unit"||t.check_availability(ai)){t.recursively_remove_reservation(c[am]);c[am].arrival=ai.arrival;c[am].departure=ai.departure;c[am].resource=ai.resource;c[am].space=ai.space;c[am].changed=true;if(c[am].status==="pending"){c[am].status="approved"}ak.helper.remove();t.draw_reservations()}else{}},over:function(ah,ai){}})}P++});if(X){if(N===0||N.getTime()-(a*1000*10)>T.getTime()){t.load_data(v,N);N=new Date(v.getTime())}}else{if(L.getTime()+(a*1000*10)<T.getTime()){var V=new Date(t.manipulate_date_without_offset(p,a*1000).getTime());t.load_data(L,V);L=V}}}};j.insertAfter("hr.wp-header-end");H.insertAfter("hr.wp-header-end");o.hide();if(a==="86400"){l.setHours(0,0,0,0);d.find(".daily").addClass("active")}else{l.setHours(l.getHours(),0,0,0);d.find(".hourly").addClass("active");g.addClass("hourly");n.width=48}m.init();t.init()})(jQuery,er_timeline_params);