(function(b,c,a){b.fn.ERBackboneModal=function(d){return this.each(function(){(new b.ERBackboneModal(b(this),d))})};b.ERBackboneModal=function(e,d){var f=b.extend({},b.ERBackboneModal.defaultOptions,d);if(f.template){new b.ERBackboneModal.View({target:f.template,string:f.variable})}};b.ERBackboneModal.defaultOptions={template:"",variable:{}};b.ERBackboneModal.View=c.View.extend({tagName:"div",id:"er-backbone-modal-dialog",_target:undefined,_string:undefined,events:{"click .modal-close":"closeButton","click #btn-ok":"addButton","touchstart #btn-ok":"addButton",keydown:"keyboardActions"},resizeContent:function(){var e=b(".er-backbone-modal-content").find("article");var d=b(window).height()*0.75;e.css("max-height",d+"px")},initialize:function(e){var d=this;this._target=e.target;this._string=e.string;a.bindAll(this,"render");this.render();b(window).resize(function(){d.resizeContent()})},render:function(){var d=wp.template(this._target);this.$el.append(d(this._string));b(document.body).css("overflow","hidden").append(this.$el);this.resizeContent();this.$(".er-backbone-modal-content").attr("tabindex","0").focus();b(document.body).trigger("init_tooltips");b(document.body).trigger("er_backbone_modal_loaded",this._target)},closeButton:function(d){d.preventDefault();b(document.body).trigger("er_backbone_modal_before_remove",this._target);this.undelegateEvents();b(document).off("focusin");b(document.body).css("overflow","auto");this.remove();b(document.body).trigger("er_backbone_modal_removed",this._target)},addButton:function(d){b(document.body).trigger("er_backbone_modal_response",[this._target,this.getFormData()]);this.closeButton(d)},getFormData:function(){var d={};b(document.body).trigger("er_backbone_modal_before_update",this._target);b.each(b("form",this.$el).serializeArray(),function(e,f){if(f.name.indexOf("[]")!==-1){f.name=f.name.replace("[]","");d[f.name]=b.makeArray(d[f.name]);d[f.name].push(f.value)}else{d[f.name]=f.value}});return d},keyboardActions:function(f){var d=f.keyCode||f.which;if(13===d&&!(f.target.tagName&&(f.target.tagName.toLowerCase()==="input"||f.target.tagName.toLowerCase()==="textarea"))){this.addButton(f)}if(27===d){this.closeButton(f)}}})}(jQuery,Backbone,_));