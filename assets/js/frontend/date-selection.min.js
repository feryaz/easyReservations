(function(a){a.fn.isInViewport=function(){const c=a(this).offset().top;const e=c+a(this).outerHeight();const b=a(window).scrollTop();const d=b+a(window).height();return e>b&&c<d};a.fn.dateSelection=function(f){const u=a(this),i=u.find(".datepicker"),g=erDatepickerArgs(),n=[],v=a.extend({resource:0,arrivalHour:false,arrivalMinute:false,departureHour:false,departureMinute:false,minDate:g.minDate,init:true,departure:true,numberOfMonths:1,time:false,price:false},f);let pageLoad=true,data=false,lastRequest=false,done=false,slots=false,resourceQuantity=false,arrival=false,arrivalTime=false,frequency=false,departure=false,departureTime=false;if(v.resource===0){v.resource=a("*[name=resource]").val()}if(v.resource&&v.resource>0){frequency=er_both_params.resources[v.resource].frequency;resourceQuantity=er_both_params.resources[v.resource].quantity}u.find("div.arrival").bind("click",function(){q()});u.find("div.departure").bind("click",function(){if(arrival&&(arrivalTime||!v.time)){b();if(!i.hasClass("hasDatepicker")){u.find(".departure .text .date").addClass("important").html(er_date_picker_params.wait);c(arrival);t()}else{u.find(".time-picker > td > div").slideUp(50,function(){i.find(".ui-state-active").removeClass("ui-state-highlight").removeClass("ui-state-active");a(this).closest(".time-picker").remove()})}}});a("*[name=resource]").bind("change",function(){s();b();v.resource=a(this).val();frequency=er_both_params.resources[v.resource].frequency;resourceQuantity=er_both_params.resources[v.resource].quantity;q()});if(v.init&&u.find("input[name=arrival]").val()===""&&v.resource&&v.resource>0){q()}function q(){u.find(".calendar").css("display","block");if(i.hasClass("hasDatepicker")){l(q)}else{u.find(".text .time").html("");data=false;slots=false;s();b();u.find(".arrival .text .date").addClass("important").html(er_date_picker_params.wait);u.find("input[name=slot]").val(-1);c(arrival?arrival:0);t()}}function d(){if(!done){if(departure){if(departureTime||!v.time){l(o);done=true}else{h()}}else{if(arrival){if(arrivalTime!==false||!v.time){if(v.departure){u.find(".departure .text .date").addClass("important").html(er_date_picker_params.wait);t()}else{if(i.hasClass("hasDatepicker")){l(d)}else{if(slots){const x=data[arrival][arrivalTime][0].departure.split(" ");const e=x[1].split(":");k(x[0]);w(e[0],e[1])}o()}done=true}}else{h()}}}}}function h(){const x=a.datepicker.formatDate("DD, d M yy",i.datepicker("getDate"));u.find("a.ui-state-active").parent().parent().after('<tr class="time-picker"><td colspan="7"><div>'+x+'<div class="insert"></div></div></td></tr>');let timeOptions="";if(slots){if(arrivalTime!==false){a.each(data[arrival][arrivalTime],function(A,z){const C=z.departure.split(" ");if(C[0]!==departure){return}const B=C[1].split(":"),D=z.availability<1?"unavailable":(z.availability<resourceQuantity?"partially":"available");let label=easyFormatTime(B[0],B[1],er_both_params.time_format);if(z.price){label+='<span class="price">('+z.price+")</span>"}timeOptions+='<li class="easy-button" data-hour="'+B[0]+'" data-minute="'+B[1]+'" data-id="'+z.key+'" class="'+D+'">'+label+"</li>"})}else{a.each(data[arrival],function(A,z){const B=A.split(":");a.each(z,function(D,C){const G=C.availability<1?"unavailable":(C.availability<resourceQuantity?"partially":"available");let label=easyFormatTime(B[0],B[1],er_both_params.time_format),attributes="";if(!v.departure){const F=C.departure.split(" ");const E=F[1].split(":");label+=" -";if(arrival!==F[0]){label+=" "+F[0]}label+=" "+easyFormatTime(E[0],E[1],er_both_params.time_format);if(C.price){label+='<span class="price">('+C.price+")</span>"}attributes+=' data-departure=" '+F[0]+'"';attributes+=' data-departure-hour=" '+E[0]+'"';attributes+=' data-departure-minute=" '+E[1]+'"'}timeOptions+='<li class="easy-button" data-hour="'+B[0]+'" data-minute="'+B[1]+'" data-id="'+C.key+'" class="'+G+'" '+attributes+">"+label+"</li>";if(v.departure){return false}})})}if(timeOptions!==""){u.find(".time-picker .insert").html('<ul class="option-buttons">'+timeOptions+"</ul>");u.find(".time-picker > td > div").slideDown(350);u.find("ul.option-buttons li").bind("click",function(){if(arrivalTime!==false){u.find("input[name=slot]").val(a(this).attr("data-id"));w(a(this).attr("data-hour"),a(this).attr("data-minute"))}else{if(!v.departure){u.find("input[name=slot]").val(a(this).attr("data-id"));k(a(this).attr("data-departure"));w(a(this).attr("data-departure-hour"),a(this).attr("data-departure-minute"))}p(a(this).attr("data-hour"),a(this).attr("data-minute"))}l(d)})}}else{if(data[departure?departure:arrival].availability&&data[departure?departure:arrival].availability===parseInt(data[departure?departure:arrival].availability,10)){u.find("div.time-prototype").contents().clone(true).appendTo(u.find(".time-picker .insert")).attr("disabled");let minMax;if(departure){minMax=data[departure].time}else{minMax=data[arrival].time}const y=data.first_possible.split(" ");if(y[0]===(departure?departure:arrival)){const e=y[1].split(":");minMax[0]=parseInt(minMax[0],10)<e[0]?parseInt(e[0],10):minMax[0]}u.find(".time-picker select[name=time_hour] option").each(function(){const z=parseInt(a(this).val());if(z<minMax[0]||z>minMax[1]){a(this).attr("disabled",true).prop("selected",false).css("display","none")}else{a(this).attr("disabled",false).css("display","block")}});if(departure){if(v.departureHour&&v.departureHour>minMax[0]&&v.departureHour<minMax[1]){u.find(".time-picker select[name=time_hour]").val(v.departureHour)}}else{if(v.arrivalHour&&v.arrivalHour>minMax[0]&&v.arrivalHour<minMax[1]){u.find(".time-picker select[name=time_hour]").val(v.arrivalHour)}}u.find(".time-picker .apply-time").bind("click",function(){const z=u.find(".time-picker select[name=time_hour]");if(z.length>0){const A=parseInt(u.find(".time-picker select[name=time_minute]").val());if(arrivalTime!==false){w(z.val(),A)}else{p(z.val(),A);if(v.departure){c(arrival)}}l(d)}})}else{a.each(data[departure?departure:arrival].availability,function(A,z){const B=A.split(" ");const C=B[0].split(":");const D=z<1?"unavailable":(z<resourceQuantity?"partially":"available");timeOptions+='<div class="time-option '+D+'" data-hour="'+C[0]+'" data-minute="'+C[1]+'">'+easyFormatTime(C[0],C[1])+"</div>"});u.find(".time-picker .insert").html('<div class="option-buttons">'+timeOptions+"</div>");u.find(".time-picker .time-option.available, .time-picker .time-option.partially").bind("click",function(){if(arrivalTime!==false){w(a(this).attr("data-hour"),a(this).attr("data-minute"))}else{p(a(this).attr("data-hour"),a(this).attr("data-minute"));if(v.departure){c(arrival)}}l(d)})}u.find(".time-picker > td > div").slideDown(350)}}function t(x){let dateFormat="dd.mm.yy";if(er_both_params.date_format==="Y/m/d"){dateFormat="yy/mm/dd"}else{if(er_both_params.date_format==="m/d/Y"){dateFormat="mm/dd/yy"}else{if(er_both_params.date_format==="Y-m-d"){dateFormat="yy-mm-dd"}else{if(er_both_params.date_format==="d-m-Y"){dateFormat="dd-mm-yy"}}}}i.datepicker(a.extend({minDate:arrival?arrival:v.minDate,maxDate:x?x:null,dateFormat:dateFormat,numberOfMonths:v.numberOfMonths,beforeShowDay:j,onChangeMonthYear:function(y,A,z){if(!slots||(!arrivalTime&&v.time)||(arrival&&!v.time)){c(dateFormat.replace("dd","01").replace("mm",A).replace("yy",y))}u.find("div.time").slideUp(300);if(arrival&&(arrivalTime||!v.time)){b();u.find(".departure .text .date").addClass("important").html(er_date_picker_params.wait)}else{s();u.find(".arrival .text .date").addClass("important").html(er_date_picker_params.wait)}},onSelect:m},g)).datepicker("setDate",null).slideDown("300");const e=i.parent().parent();if(!pageLoad&&resourceQuantity&&i.hasClass("hasDatepicker")&&!e.isInViewport()){a([document.documentElement,document.body]).animate({scrollTop:e.offset().top-30},500)}pageLoad=false;i.find(".ui-datepicker").removeClass("ui-datepicker").addClass("easy-datepicker");i.find(".ui-state-active").removeClass("ui-state-highlight").removeClass("ui-state-hover").removeClass("ui-state-active");a.each(er_date_picker_params.datepicker,function(z,y){i.datepicker("option",z,JSON.parse(y))})}function s(){arrival=false;arrivalTime=false;u.find(".arrival .text .date").addClass("important").html(er_date_picker_params.select);u.find(".arrival .text .time").html("");u.find("input[name=arrival]").val("");u.find("input[name=departure_hour]").val("");u.find("input[name=departure_minute]").val("")}function b(){departure=false;departureTime=false;done=false;if(arrival){u.find(".departure .text .date").addClass("important").html(er_date_picker_params.select)}else{u.find(".departure .text .date").removeClass("important").html("&#8212;")}u.find(".departure .text .time").html("");u.find("input[name=departure]").val("");u.find("input[name=departure_hour]").val("");u.find("input[name=departure_minute]").val("");u.find(".departure").removeClass("active")}function r(e){arrival=e;u.find(".arrival .text .date").removeClass("important").html(e);u.find("input[name=arrival]").val(e);u.find("input[name=arrival_hour]").val("");u.find("input[name=arrival_minute]").val("")}function k(e){departure=e;u.find("input[name=departure]").val(e);u.find(".departure").addClass("active");u.find(".departure .text .date").removeClass("important").html(e)}function p(e,y,x){e=easyAddZero(e);y=easyAddZero(y);if(!x){x=easyFormatTime(e,y)}arrivalTime=e+":"+y;u.find("input[name=arrival_hour]").val(e);u.find("input[name=arrival_minute]").val(y);u.find(".arrival .text .time").html(x)}function w(e,y,x){e=easyAddZero(e);y=easyAddZero(y);if(!x){x=easyFormatTime(e,y)}departureTime=e+":"+y;u.find("input[name=departure_hour]").val(e);u.find("input[name=departure_minute]").val(y);u.find(".departure .text .time").html(x)}function m(z,e){if(arrival&&(arrivalTime!==false||!v.time)){if(departure===z){b();u.find(".time-picker > td > div").slideUp(50,function(){i.find(".ui-state-active").removeClass("ui-state-highlight").removeClass("ui-state-active")});return false}k(z);if(v.time){setTimeout(h,1)}else{if(slots){const x=false;a.each(data[arrival][arrivalTime],function(B,A){const D=A.departure.split(" ");if(departure===D[0]){const C=D.split(":");w(C[0],C[1]);return false}})}else{w(v.departureHour?v.departureHour:data[departure].time[0],v.departureMinute?v.departureMinute:0)}l(d)}}else{if(arrival===z){s();u.find(".time-picker > td > div").slideUp(50,function(){i.find(".ui-state-active").removeClass("ui-state-highlight").removeClass("ui-state-active")});return false}r(z);if(v.time){setTimeout(h,1)}else{let hour=12,minute=v.arrivalHour?v.arrivalMinute:0;if(slots){const y=Object.keys(data[arrival])[0].split(":");hour=y[0];minute=y[1]}else{hour=v.arrivalHour?v.arrivalHour:data[arrival].time[1]}p(hour,minute);if(v.departure){u.find(".departure .text .date").addClass("important").html(er_date_picker_params.wait);c(arrival)}l(d)}}}function l(e){i.slideUp(350,function(){a(this).datepicker("destroy").removeClass("hasDatepicker").removeAttr("id");if(e){e()}})}function j(x){let className="";if(data){const e=easyFormatDate(x,false);if(slots&&arrival&&arrivalTime!==false){if(easyStringToDate(arrival)>x){return[false,"past",""]}let toReturn=[false,"unavailable",""],iterate;if(arrivalTime!==false&&v.time){iterate=data[arrival][arrivalTime]}else{iterate=data[arrival][Object.keys(data[arrival])[0]]}a.each(iterate,function(z,y){const A=y.departure.split(" ");if(A[0]===e){toReturn=[true,"available",""];return true}});return toReturn}if(data.hasOwnProperty(e)){if(data[e].price){className="datepicker-content-"+data[e].price.hashCode();if(a.inArray(className,n)===-1){a("head").append("<style>.easy-date-selection td."+className+"  a:after {content: '"+data[e].price+"'}</style>");n.push(className)}}else{if(v.price&&!slots&&frequency===86400){className="price-placeholder"}}if(data[e].availability&&data[e].availability===parseInt(data[e].availability,10)){if(data[e].availability<0){return[false,"unavailable rule "+className,""]}if(data[e].availability<1){return[false,"unavailable "+className,""]}if(data[e].availability<resourceQuantity){return[true,"partially "+className,""]}}else{let amountAvailable=0,hasAvailableSlot=false,total;if(slots){total=data[e][Object.keys(data[e])[0]];a.each(total,function(z,y){if(y.availability>0){hasAvailableSlot=true;amountAvailable++}})}else{total=data[e].availability;a.each(total,function(z,y){if(y>0){hasAvailableSlot=true;amountAvailable++}})}if(!hasAvailableSlot){return[false,"unavailable "+className,""]}if(Object.keys(total).length>amountAvailable){return[true,"partially "+className,""]}}return[true,"available "+className,""]}}if(v.price&&!slots&&frequency===86400){className="price-placeholder"}return[false,"past "+className,""]}function c(x){const e=Date.now(),y={action:"easyreservations_calendar",date:x===0?0:x,arrival:arrival&&(arrivalTime!==false||!v.time)?arrival:0,arrivalTime:arrivalTime,months:v.numberOfMonths,adults:a("*[name=adults]").val(),children:a("*[name=children]").val(),resource:v.resource,price:v.price,minDate:v.minDate,security:u.find('input[name="easy-date-selection-nonce"]').val()};lastRequest=e;data=false;if(!y.resource){alert("no resource field in form, please fix");return}a.post(er_both_params.ajaxurl,y,function(z){if(lastRequest===e){if(arrival&&(arrivalTime||!v.time)){u.find(".departure .text .date").addClass("important").html(er_date_picker_params.select)}else{u.find(".arrival .text .date").html(er_date_picker_params.select)}data=z;slots=data.hasOwnProperty("slots")&&data.slots;if(data.first_possible){const A=data.first_possible.split(" ");if(arrival){i.datepicker("option","minDate",A[0])}}if(data.hasOwnProperty("max")&&data.max){i.datepicker("refresh")}else{i.datepicker("refresh")}i.find(".ui-datepicker-today a, .ui-datepicker-current-day a").removeClass("ui-state-highlight").removeClass("ui-state-hover").removeClass("ui-state-active")}})}function o(){u.find("input[name=arrival]").trigger("change")}}}(jQuery));Object.defineProperty(String.prototype,"hashCode",{value:function(){var c=0,a,b;for(a=0;a<this.length;a++){b=this.charCodeAt(a);c=((c<<5)-c)+b;c|=0}return c}});