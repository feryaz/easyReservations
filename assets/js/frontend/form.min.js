(function(b){b.fn.serializeObject=function(){var c={};b.each(this.serializeArray(),function(){if(c[this.name]){if(this.name.slice(-2)==="[]"){if(!c[this.name].push){c[this.name]=[c[this.name]]}c[this.name].push(this.value||"")}else{c[this.name]=this.value||""}}else{c[this.name]=this.value||""}});return c};var a={$form:b("form[rel=js-easy-form]"),init:function(){b(document.body).on("submit","form[rel=js-easy-form]",this.submit);b("form[rel=js-easy-form] > div > label, .easyreservations-additional-fields > label").each(function(){b(this).next("div.content, div.easy-date-selection").andSelf().wrapAll('<div class="form-row"/>')});a.$form.attr("novalidate","novalidate");if(this.$form.attr("name")!=="checkout"){this.$form.on("change",".validate",this.validate)}a.$form.on("input validate change",".input-text, select, input:checkbox, input:text, textarea",this.validate_field)},ajaxRequest:function(c,e){if(c.is(".processing")){return false}c.addClass("processing");if(e){c.block({message:null,overlayCSS:{background:"#fff",opacity:0.6}})}c.find(".easy-price").block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});var d=c.serializeObject();d.action="easyreservations_form";if(e){d.submit="yes"}b.ajax({type:"POST",url:er_both_params.ajaxurl,data:d,dataType:"json",success:function(f){a.detachUnloadEventsOnSubmit();try{if("success"===f.result){if(f.redirect){if(-1===f.redirect.indexOf("https://")||-1===f.redirect.indexOf("http://")){window.location=f.redirect}else{window.location=decodeURI(f.redirect)}}else{if(f.price){c.find(".easy-price").unblock().css("display","block");c.find(".easy-price-display").html(f.price)}else{c.find(".easy-price").css("display","none")}if(f.order_review){c.find(".easyreservations-checkout-review-order").html(f.order_review)}b(".easyreservations-NoticeGroup-checkout, .easyreservations-error, .easyreservations-message").remove();if(f.messages){c.html('<div class="easyreservations-message">'+f.messages+"</div>");a.scroll_to_notices()}else{c.find(".input-text, select, input:checkbox, input:text, textarea").trigger("validate").blur()}c.removeClass("processing").unblock()}}else{if("failure"===f.result){throw"Result failure"}else{throw"Invalid response"}}}catch(g){if(true===f.reload){window.location.reload();return}c.find(".easy-price").unblock().css("display","none");if(true===f.refresh){b(document.body).trigger("update_checkout")}if(f.messages){a.submit_error(c,f.messages)}else{c.removeClass("processing").unblock()}}},error:function(f,h,g){a.submit_error(c,'<div class="easyreservations-error">'+g+"</div>")}})},validate_field:function(i){var h=b(this),g=h.closest(".form-row"),j=true,f=g.is(".validate-required"),c=g.is(".validate-email"),k=i.type;if(h.hasClass("do-not-validate")){return}if("input"===k){g.removeClass("easyreservations-invalid easyreservations-invalid-required-field easyreservations-invalid-email easyreservations-validated")}if("validate"===k||"change"===k){if(f){if("checkbox"===h.attr("type")&&!h.is(":checked")){g.removeClass("easyreservations-validated").addClass("easyreservations-invalid easyreservations-invalid-required-field");j=false}else{if(h.val()===""){g.removeClass("easyreservations-validated").addClass("easyreservations-invalid easyreservations-invalid-required-field");j=false}}}if(c){if(h.val()){var d=new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);if(!d.test(h.val())){g.removeClass("easyreservations-validated").addClass("easyreservations-invalid easyreservations-invalid-email");j=false}}}if(j){if(b('.er-error-type[data-type="'+h.attr("name")+'"]').length>0){g.removeClass("easyreservations-validated").addClass("easyreservations-invalid");j=false}}if(j){g.removeClass("easyreservations-invalid easyreservations-invalid-required-field easyreservations-invalid-email").addClass("easyreservations-validated")}}},submit_error:function(d,c){b(".easyreservations-NoticeGroup-checkout, .easyreservations-error, .easyreservations-message").remove();d.prepend('<div class="easyreservations-NoticeGroup easyreservations-NoticeGroup-checkout">'+c+"</div>");d.removeClass("processing").unblock();d.find(".input-text, select, input:checkbox, input:text, textarea").trigger("validate").blur();a.scroll_to_notices();b(document.body).trigger("form_error")},scroll_to_notices:function(){var c=b(".easyreservations-NoticeGroup-updateOrderReview, .easyreservations-NoticeGroup-checkout");if(!c.length){c=b("form[rel=js-easy-form]")}if(c.length){b("html, body").animate({scrollTop:(c.offset().top-100)},1000)}},submit:function(c){c.preventDefault();if(a.$form.triggerHandler("checkout_place_order")!==false&&a.$form.triggerHandler("checkout_place_order_"+a.get_payment_method())!==false){a.ajaxRequest(b(this).closest("form"),true)}},get_payment_method:function(){return a.$form.find('input[name="payment_method"]:checked').val()},validate:function(){a.ajaxRequest(b(this).closest("form"),false)},handleUnloadEvent:function(c){if((navigator.userAgent.indexOf("MSIE")!==-1)||(!!document.documentMode)){c.preventDefault();return undefined}return true},attachUnloadEventsOnSubmit:function(){b(window).on("beforeunload",this.handleUnloadEvent)},detachUnloadEventsOnSubmit:function(){b(window).unbind("beforeunload",this.handleUnloadEvent)}};a.init()})(jQuery);