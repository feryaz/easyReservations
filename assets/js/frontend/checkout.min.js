(function(b,a){b(function(){b(".er-selection-box li:first-child input[name=deposit_type]").prop("checked",true);var d={updateTimer:false,selectedPaymentMethod:false,$order_review:b("#order_review"),$checkout_form:b("form.checkout"),init:function(){b(document.body).on("update_checkout",this.update_checkout);b(document.body).on("init_checkout",this.init_checkout);if(b(document.body).hasClass("easyreservations-order-pay")){this.$order_review.on("click",'input[name="payment_method"]',this.payment_method_selected);this.$order_review.attr("novalidate","novalidate")}this.$checkout_form.on("click",'input[name="payment_method"]',this.payment_method_selected);this.$checkout_form.on("change",".validate",this.update_checkout);this.$checkout_form.on("change",'input[name="deposit_type"]',this.update_checkout);this.init_payment_methods();if(er_checkout_params.is_checkout==="1"){b(document.body).trigger("init_checkout")}if(er_checkout_params.option_guest_checkout==="yes"){b("input#createaccount").on("change",this.toggle_create_account).trigger("change")}},init_payment_methods:function(){var h=b(".easyreservations-checkout").find('input[name="payment_method"]');if(1===h.length){h.eq(0).hide()}if(d.selectedPaymentMethod){b("#"+d.selectedPaymentMethod).prop("checked",true)}if(0===h.filter(":checked").length){h.eq(0).prop("checked",true)}var g=h.filter(":checked").eq(0).prop("id");if(h.length>1){b('div.payment_box:not(".'+g+'")').filter(":visible").slideUp(0)}h.filter(":checked").eq(0).trigger("click")},get_payment_method:function(){return d.$checkout_form.find('input[name="payment_method"]:checked').val()},payment_method_selected:function(i){i.stopPropagation();if(b(".payment_methods input.input-radio").length>1){var h=b("div.payment_box."+b(this).attr("ID")),g=b(this).is(":checked");if(g&&!h.is(":visible")){b("div.payment_box").filter(":visible").slideUp(230);if(g){h.slideDown(230)}}}else{b("div.payment_box").show()}if(b(this).data("order_button_text")){b("#place_order").text(b(this).data("order_button_text"))}else{b("#place_order").text(b("#place_order").data("value"))}var j=b('.easyreservations-checkout input[name="payment_method"]:checked').attr("id");if(j!==d.selectedPaymentMethod){b(document.body).trigger("payment_method_selected")}d.selectedPaymentMethod=j},toggle_create_account:function(){b("div.create-account").hide();if(b(this).is(":checked")){b("#account_password").val("").trigger("change");b("div.create-account").slideDown()}},init_checkout:function(){b(document.body).trigger("updated_checkout")},update_checkout:function(h,g){d.reset_update_checkout_timer();d.updateTimer=setTimeout(d.update_checkout_action,"5",g)},reset_update_checkout_timer:function(){clearTimeout(d.updateTimer)},update_checkout_action:function(o){if(d.xhr){d.xhr.abort()}if(b("form.checkout").length===0){return}var l=b("form.checkout").serializeObject(),h=b("#country").val(),g=b("#state").val(),m=b(":input#postcode").val(),k=b("#city").val(),p=b(":input#address_1").val(),i=b(":input#address_2").val(),n=b(d.$checkout_form).find(".address-field.validate-required:visible"),j=true;if(n.length){n.each(function(){if(b(this).find(":input").val()===""){j=false}})}l.security=er_checkout_params.update_order_review_nonce;l.payment_method=d.get_payment_method();l.country=h;l.state=g;l.postcode=m;l.city=k;l.address=p;l.address_2=i;l.has_full_address=j;b(".easyreservations-checkout-payment, .easyreservations-checkout-review-order-table, .easyreservations-checkout-deposit").block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});d.xhr=b.ajax({type:"POST",url:er_checkout_params.er_ajax_url.toString().replace("%%endpoint%%","update_order_review"),data:l,success:function(s){if(s&&true===s.reload){window.location.reload();return}b(".easyreservations-NoticeGroup-updateOrderReview").remove();const r=b("#terms").prop("checked");const t={};b(".payment_box :input").each(function(){var u=b(this).attr("id");if(u){if(b.inArray(b(this).attr("type"),["checkbox","radio"])!==-1){t[u]=b(this).prop("checked")}else{t[u]=b(this).val()}}});if(s&&s.fragments){b.each(s.fragments,function(u,v){if(!d.fragments||d.fragments[u]!==v){b(u).replaceWith(v)}b(u).unblock()});d.fragments=s.fragments}if(r){b("#terms").prop("checked",true)}if(!b.isEmptyObject(t)){b(".payment_box :input").each(function(){const u=b(this).attr("id");if(u){if(b.inArray(b(this).attr("type"),["checkbox","radio"])!==-1){b(this).prop("checked",t[u]).trigger("change")}else{if(b.inArray(b(this).attr("type"),["select"])!==-1){b(this).val(t[u]).trigger("change")}else{if(null!==b(this).val()&&0===b(this).val().length){b(this).val(t[u]).trigger("change")}}}}})}if(s&&"failure"===s.result){const q=b("form.checkout");b(".easyreservations-error, .easyreservations-message").remove();if(s.messages){q.prepend('<div class="easyreservations-NoticeGroup easyreservations-NoticeGroup-updateOrderReview">'+s.messages+"</div>")}else{q.prepend(s)}q.find(".input-text, select, input:checkbox").trigger("validate").trigger("blur");d.scroll_to_notices()}d.init_payment_methods();b(document.body).trigger("updated_checkout",[s])}})}};var f={init:function(){b(document.body).on("click","a.showcoupon",this.show_coupon_form);b(document.body).on("click",".easyreservations-remove-coupon",this.remove_coupon);b("form.checkout_coupon").hide().on("submit",this.submit)},show_coupon_form:function(){b(".checkout_coupon").slideToggle(400,function(){b(".checkout_coupon").find(":input:eq(0)").focus()});return false},submit:function(){var g=b(this);if(g.is(".processing")){return false}g.addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});var h={security:er_checkout_params.apply_coupon_nonce,coupon_code:g.find('input[name="coupon_code"]').val()};b.ajax({type:"POST",url:er_checkout_params.er_ajax_url.toString().replace("%%endpoint%%","apply_coupon"),data:h,success:function(i){b(".easyreservations-error, .easyreservations-message").remove();g.removeClass("processing").unblock();if(i){g.before(i);g.slideUp();b(document.body).trigger("applied_coupon_in_checkout",[h.coupon_code]);b(document.body).trigger("update_checkout",{})}},dataType:"html"});return false},remove_coupon:function(j){j.preventDefault();var g=b(this).parents(".easyreservations-checkout-review-order"),h=b(this).data("coupon");g.addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:0.6}});var i={security:er_checkout_params.remove_coupon_nonce,coupon:h};b.ajax({type:"POST",url:er_checkout_params.er_ajax_url.toString().replace("%%endpoint%%","remove_coupon"),data:{security:er_checkout_params.remove_coupon_nonce,coupon:h},success:function(k){b(".easyreservations-error, .easyreservations-message").remove();g.removeClass("processing").unblock();if(k){b("form.easyreservations-checkout").before(k);b(document.body).trigger("removed_coupon_in_checkout",[i.coupon]);b(document.body).trigger("update_checkout",{});b("form.checkout_coupon").find('input[name="coupon_code"]').val("")}},error:function(k){if(er_checkout_params.debug_mode){console.log(k.responseText)}},dataType:"html"})}};var c={init:function(){b(document.body).on("click","a.showlogin",this.show_login_form)},show_login_form:function(){b("form.login, form.easyreservations-form--login").slideToggle();return false}};var e={init:function(){b(document.body).on("click","a.easyreservations-terms-and-conditions-link",this.toggle_terms)},toggle_terms:function(){if(b(".easyreservations-terms-and-conditions").length){b(".easyreservations-terms-and-conditions").slideToggle(function(){var g=b(".easyreservations-terms-and-conditions-link");if(b(".easyreservations-terms-and-conditions").is(":visible")){g.addClass("easyreservations-terms-and-conditions-link--open");g.removeClass("easyreservations-terms-and-conditions-link--closed")}else{g.removeClass("easyreservations-terms-and-conditions-link--open");g.addClass("easyreservations-terms-and-conditions-link--closed")}});return false}}};d.init();f.init();c.init();e.init();b("form.checkout > label").each(function(){b(this).next("div.content").addBack().wrapAll('<p class="form-row"/>')})})})(jQuery,er_checkout_params);